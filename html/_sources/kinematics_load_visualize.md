---
jupytext:
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.13.8
kernelspec:
  display_name: Python 3 (ipykernel)
  language: python
  name: python3
---

```{code-cell} ipython3
:tags: [remove-cell]
%matplotlib inline
```

# Reading and visualizing marker trajectories

In this tutorial, we will visualize the kinematics of an athlete who propelled a racing wheelchair on a training roller during 10 seconds. In this acquisition, the marker trajectories were saved as a `c3d` file.

```{code-cell} ipython3
import kineticstoolkit.lab as ktk
```

## Reading marker trajectories

:::{margin}
In a future version, ktk.kinematics.read_c3d_file() will be replaced by ktk.read_c3d() and will be able to read analog and force platform data in addition to markers.
:::

The [](api/ktk.kinematics.rst) module provide the functions [](api/ktk.kinematics.read_c3d_file.rst) and [](api/ktk.kinematics.read_n3d_file.rst) to read files generated by common motion capture devices.

For example:

```{code-cell} ipython3
markers = ktk.kinematics.read_c3d_file(
    ktk.doc.download("kinematics_racing_full.c3d")
)

markers
```

We see that this acquisition has 46 markers. Each data key corresponds to the trajectory of one marker:

```{code-cell} ipython3
markers.data
```

## Visualizing the markers

Now we'll take a look at this acquisition using [](api/ktk.Player.rst), a matplotlib-based interactive user interface aimed at visualizing markers, rigid bodies and segments in three dimensions.

For the `Player` class to be interactive, you must select an interactive backend for IPython. See [](ktk_installing.md) for more information. As a reminder, you allow interactive figures using:

```
%matplotlib qt5
```

Then, to visualize the markers:

```{code-cell} ipython3
:tags: [remove-output]

ktk.Player(markers)
```

```{code-cell} ipython3
:tags: [remove-input]

viewing_options = {
    "zoom": 3.5,
    "azimuth": 0.8,
    "elevation": 0.16,
    "translation": (0.2, -0.7),
}

player = ktk.Player(markers, **viewing_options)

player.to_html5(
    start_time=0, stop_time=1
)  # Show only one second of acquisition
```

In the Player window, press space to start the video, zoom and drag with the mouse, or press `h` in the Player window for additional help.

Note the colored global reference frame on the bottom. This reference frame and every other (as we will create in the next tutorial) follow the same standard color scheme:

- x = Red
- y = Green
- z = Blue

## Interconnecting the markers

To ease the visualization, it is often practical to interconnect markers with lines. Here, we will create links between the right arm markers and between the right forearm markers.

```{code-cell} ipython3
interconnections = dict()  # Will contain all segment definitions

# Right arm
interconnections["ArmR"] = {
    # Segment color in [red, green, blue] (each between 0 et 1)
    "Color": [1, 0.25, 0],
    # List of links, defined by marker names
    "Links": [
        ["AcromionR", "MedialEpicondyleR"],
        ["AcromionR", "LateralEpicondyleR"],
        ["AcromionR", "OlecraneR"],
    ],
}

# Right forearm
interconnections["ForearmR"] = {
    "Color": [1, 0.5, 0],
    "Links": [
        ["MedialEpicondyleR", "RadialStyloidR"],
        ["MedialEpicondyleR", "UlnarStyloidR"],
        ["LateralEpicondyleR", "RadialStyloidR"],
        ["LateralEpicondyleR", "UlnarStyloidR"],
        ["OlecraneR", "RadialStyloidR"],
        ["OlecraneR", "UlnarStyloidR"],
        ["UlnarStyloidR", "RadialStyloidR"],
    ],
}
```

Now we can load a Player again with the segments we just defined:

```{code-cell} ipython3
:tags: [remove-output]

ktk.Player(markers, interconnections=interconnections)
```

```{code-cell} ipython3
:tags: [remove-input]

player = ktk.Player(
    markers, interconnections=interconnections, **viewing_options
)

player.to_html5(
    start_time=0, stop_time=1
)  # Show only one second of acquisition
```
