
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kineticstoolkit.anthropometrics &mdash; Kinetics Toolkit</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-thebe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/stable.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
        <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />


 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
            <a href="../../index.html">
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_ktk.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ktk_in_depth.html">In depth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_learning.html">Learning Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_modules.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/felixchenier/kineticstoolkit">GitHub repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev.html">Developing Kinetics Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_tutorials.html">Tutorial development for stable/unstable features</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>kineticstoolkit.anthropometrics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kineticstoolkit.anthropometrics</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright 2020-2021 Félix Chénier</span>

<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>

<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Provide tools associated to anthropometric measurements and estimates.</span>

<span class="sd">Warning</span>
<span class="sd">-------</span>
<span class="sd">This module is in very early development and everything can still change.</span>
<span class="sd">Please don&#39;t use this module in production code.</span>


<span class="sd">Nomenclature</span>
<span class="sd">------------</span>
<span class="sd">Skin markers (either real or reconstructed):</span>

<span class="sd">- HeadVertex</span>
<span class="sd">- Sellion</span>
<span class="sd">- C7</span>
<span class="sd">- Suprasternale</span>
<span class="sd">- PubicSymphysis</span>
<span class="sd">- AnteriorSuperiorIliacSpineR/L</span>
<span class="sd">- PosteriorSuperiorIliacSpineR/L</span>
<span class="sd">- AcromionR/L</span>
<span class="sd">- LateralHumeralEpicondyleR/L</span>
<span class="sd">- MedialHumeralEpicondyleR/L</span>
<span class="sd">- UlnarStyloidR/L</span>
<span class="sd">- RadialStyloidR/L</span>
<span class="sd">- CarpalMetaHead2R/L</span>
<span class="sd">- CarpalMetaHead5R/L</span>
<span class="sd">- HipJointCenterR/L</span>
<span class="sd">- LateralFemoralEpicondyleR/L</span>
<span class="sd">- MedialFemoralEpicondyleR/L</span>
<span class="sd">- LateralMalleolusR/L</span>
<span class="sd">- MedialMalleolusR/L</span>
<span class="sd">- CalcaneusR/L</span>
<span class="sd">- NavicularR/L</span>
<span class="sd">- TarsalMetaHead1R/L</span>
<span class="sd">- TarsalMetaHead5R/L</span>

<span class="sd">Inferred joint centers:</span>

<span class="sd">- L5S1JointCenter</span>
<span class="sd">- C7T1JointCenter</span>
<span class="sd">- GlenohumeralJointCenterR/L</span>
<span class="sd">- ElbowJointCenterR/L</span>
<span class="sd">- WristJointCenterR/L</span>
<span class="sd">- KneeJointCenterR/L</span>
<span class="sd">- AnkleJointCenterR/L</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Félix Chénier&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2020-2021 Félix Chénier&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;chenier.felix@uqam.ca&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Apache 2.0&quot;</span>


<span class="kn">from</span> <span class="nn">kineticstoolkit.decorators</span> <span class="kn">import</span> <span class="n">unstable</span><span class="p">,</span> <span class="n">directory</span>
<span class="kn">from</span> <span class="nn">kineticstoolkit</span> <span class="kn">import</span> <span class="n">TimeSeries</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">kinematics</span><span class="p">,</span> <span class="n">Player</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>


<div class="viewcode-block" id="infer_joint_centers"><a class="viewcode-back" href="../../api/kineticstoolkit.anthropometrics.infer_joint_centers.html#kineticstoolkit.anthropometrics.infer_joint_centers">[docs]</a><span class="nd">@unstable</span>
<span class="k">def</span> <span class="nf">infer_joint_centers</span><span class="p">(</span>
        <span class="n">markers</span><span class="p">:</span> <span class="n">TimeSeries</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="n">segment</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeries</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Infer joint centers based on anthropometric data.</span>

<span class="sd">    This function is aimed to be used on static acquisitions in quasi-neutral</span>
<span class="sd">    position.</span>

<span class="sd">    For the pelvis, creates L5S1JointCenter, HipJointCenterL and</span>
<span class="sd">    HipJointCenterR based on AnteriorSuperiorIliacSpineR/L,</span>
<span class="sd">    PosteriorSuperiorIliacSpineR/L and PubicSymphysis, following the method</span>
<span class="sd">    presented in Reed et al. (1999).</span>

<span class="sd">    For the thorax, creates C7T1JointCenter, GlenohumeralJointCenterL and</span>
<span class="sd">    GlenohumeralJointCenterR based on C7, L5S1JointCenter, Suprasternal,</span>
<span class="sd">    AcromionR and AcromionL, following the method presented in Reed et al.</span>
<span class="sd">    (1999). The scapulo-thoracic joint must be in a neutral</span>
<span class="sd">    position.</span>

<span class="sd">    For the extremities, creates:</span>

<span class="sd">    - ElbowJointCenterR/L as the midpoint between</span>
<span class="sd">      LateralHumeralEpicondyleR/L and MedialHumeralEpicondyleR;</span>
<span class="sd">    - WristJointCenterR as the midpoint between</span>
<span class="sd">      UlnarStyloidR/L and RadialStyloidR/L;</span>
<span class="sd">    - KneeJointCenterR/L as the midpoint between</span>
<span class="sd">      LateralFemoralEpicondyleR/L and MedialFemoralEpicondyleR/L;</span>
<span class="sd">    - AnkleJointCenterR/L as the midpoint between</span>
<span class="sd">      LateralMalleolusR/L and MedialMalleolusR/L.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    markers</span>
<span class="sd">        TimeSeries that contain the trajectory of the required markers as</span>
<span class="sd">        Nx4 series.</span>
<span class="sd">    segment</span>
<span class="sd">        Can be either &#39;Pelvis&#39;, &#39;Thorax&#39;, or &#39;Extremities&#39;. An error is raised</span>
<span class="sd">        in case of missing markers.</span>
<span class="sd">    sex</span>
<span class="sd">        Optional. Can be either &#39;M&#39; or &#39;F&#39;. The default is &#39;M&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    TimeSeries</span>
<span class="sd">        A TimeSeries that contains the inferred joint center trajectories.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    - Reed, M., Manary, M.A., Schneider, L.W., 1999. Methods for Measuring and</span>
<span class="sd">      Representing Automobile Occupant Posture. Presented at the International</span>
<span class="sd">      Congress &amp;  Exposition, pp. 1999-01–0959.</span>
<span class="sd">      https://doi.org/10.4271/1999-01-0959</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">segment</span> <span class="o">==</span> <span class="s1">&#39;Pelvis&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_infer_pelvis_joint_centers</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="n">sex</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">segment</span> <span class="o">==</span> <span class="s1">&#39;Thorax&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_infer_thorax_joint_centers</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="n">sex</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">segment</span> <span class="o">==</span> <span class="s1">&#39;Extremities&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_infer_extremity_joint_centers</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">segment</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">,</span> <span class="s1">&#39;Thorax&#39;</span><span class="p">,</span> <span class="s1">&#39;Extremities&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                    <span class="n">infer_joint_centers</span><span class="p">(</span>
                        <span class="n">out</span><span class="p">,</span>
                        <span class="n">segment</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span>
                        <span class="n">sex</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized segment name.&quot;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_infer_pelvis_joint_centers</span><span class="p">(</span>
        <span class="n">markers</span><span class="p">:</span> <span class="n">TimeSeries</span><span class="p">,</span>
        <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeries</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Infer L5S1 and hip joint centers based on anthropometric data.&quot;&quot;&quot;</span>
    <span class="c1"># Get the required markers</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rasis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineR&#39;</span><span class="p">]</span>
        <span class="n">lasis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineL&#39;</span><span class="p">]</span>
        <span class="n">rpsis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineR&#39;</span><span class="p">]</span>
        <span class="n">lpsis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineL&#39;</span><span class="p">]</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PubicSymphysis&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Not enough markers to reconstruct L5S1 and hip joint centers.&quot;</span><span class="p">)</span>

    <span class="c1"># Create a local coordinate system at the anterior superior iliac spines</span>
    <span class="c1"># midpoint, according to Reed et al.</span>
    <span class="n">masis</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">rasis</span> <span class="o">+</span> <span class="n">lasis</span><span class="p">)</span>
    <span class="n">lcs</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">masis</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">lasis</span> <span class="o">-</span> <span class="n">rasis</span><span class="p">,</span>
        <span class="n">yz</span><span class="o">=</span><span class="n">masis</span> <span class="o">-</span> <span class="n">sym</span>
    <span class="p">)</span>

    <span class="c1"># Calculate the markers in the local coordinate system</span>
    <span class="n">local_rasis</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span><span class="n">rasis</span><span class="p">,</span> <span class="n">lcs</span><span class="p">)</span>
    <span class="n">local_lasis</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span><span class="n">lasis</span><span class="p">,</span> <span class="n">lcs</span><span class="p">)</span>
    <span class="n">local_rpsis</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span><span class="n">rpsis</span><span class="p">,</span> <span class="n">lcs</span><span class="p">)</span>
    <span class="n">local_lpsis</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span><span class="n">lpsis</span><span class="p">,</span> <span class="n">lcs</span><span class="p">)</span>
    <span class="n">local_sym</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">lcs</span><span class="p">)</span>

    <span class="c1"># Create a cluster using these locations</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;AnteriorSuperiorIliacSpineR&#39;</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">local_rasis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
        <span class="s1">&#39;AnteriorSuperiorIliacSpineL&#39;</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">local_lasis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
        <span class="s1">&#39;PosteriorSuperiorIliacSpineR&#39;</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">local_rpsis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
        <span class="s1">&#39;PosteriorSuperiorIliacSpineL&#39;</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">local_lpsis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
        <span class="s1">&#39;PubicSymphysis&#39;</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">local_sym</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="c1"># Track the pelvis using this definition</span>
    <span class="n">tracked_pelvis</span> <span class="o">=</span> <span class="n">kinematics</span><span class="o">.</span><span class="n">track_cluster</span><span class="p">(</span>
        <span class="n">markers</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">include_lcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lcs_name</span><span class="o">=</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">)</span>

    <span class="c1"># Pelvis width</span>
    <span class="n">pw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
        <span class="n">local_rasis</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">local_lasis</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">))</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy_data_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Create L5S1JointCenter</span>
    <span class="k">if</span> <span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
        <span class="n">local_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="o">-</span><span class="mf">0.289</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.172</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
        <span class="n">local_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="o">-</span><span class="mf">0.264</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.126</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;sex must be either &#39;M&#39; or &#39;F&#39;&quot;</span><span class="p">)</span>

    <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;L5S1JointCenter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
        <span class="n">local_position</span><span class="p">,</span> <span class="n">tracked_pelvis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Create HipJointCenterR if not already included in markers</span>
    <span class="k">if</span> <span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
        <span class="n">local_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="o">-</span><span class="mf">0.197</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.372</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.270</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># M</span>
        <span class="n">local_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="o">-</span><span class="mf">0.208</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.361</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.278</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
        <span class="n">local_position</span><span class="p">,</span> <span class="n">tracked_pelvis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Create HipJointCenterL if not already included in markers</span>
    <span class="k">if</span> <span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
        <span class="n">local_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="o">-</span><span class="mf">0.197</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">0.372</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.270</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># M</span>
        <span class="n">local_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="o">-</span><span class="mf">0.208</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">0.361</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.278</span> <span class="o">*</span> <span class="n">pw</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
        <span class="n">local_position</span><span class="p">,</span> <span class="n">tracked_pelvis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span>


<span class="k">def</span> <span class="nf">_infer_thorax_joint_centers</span><span class="p">(</span>
        <span class="n">markers</span><span class="p">:</span> <span class="n">TimeSeries</span><span class="p">,</span>
        <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeries</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Infer C7T1 and glenohumeral joint centers based on anthropom. data.&quot;&quot;&quot;</span>
    <span class="c1"># Get the required markers</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c7</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;C7&#39;</span><span class="p">]</span>
        <span class="n">l5s1</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;L5S1JointCenter&#39;</span><span class="p">]</span>
        <span class="n">sup</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Suprasternale&#39;</span><span class="p">]</span>
        <span class="n">rac</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AcromionR&#39;</span><span class="p">]</span>
        <span class="n">lac</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AcromionL&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Not enough markers to reconstruct C7T1 and GH joint centers.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
        <span class="n">c7t1_angle</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># deg</span>
        <span class="n">c7t1_ratio</span> <span class="o">=</span> <span class="mf">0.55</span>
        <span class="n">gh_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">67</span>  <span class="c1"># deg</span>
        <span class="n">gh_ratio</span> <span class="o">=</span> <span class="mf">0.42</span>
    <span class="c1"># elif sex == &#39;F&#39;:</span>
    <span class="c1">#     c7t1_angle = 14  # deg</span>
    <span class="c1">#     c7t1_ratio = 0.53</span>
    <span class="c1">#     gh_angle = -5  # deg</span>
    <span class="c1">#     gh_ratio = 0.53</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;sex must be &#39;M&#39; for now.&quot;</span><span class="p">)</span>

    <span class="c1"># Create reference frames with x: X7-SUP, y: L5S1-C7, z: right</span>
    <span class="n">c7sup</span> <span class="o">=</span> <span class="n">sup</span> <span class="o">-</span> <span class="n">c7</span>
    <span class="n">c7_lcs</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">c7</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">c7sup</span><span class="p">),</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">c7</span> <span class="o">-</span> <span class="n">l5s1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">rac_lcs</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">rac</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">c7sup</span><span class="p">),</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">c7</span> <span class="o">-</span> <span class="n">l5s1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">lac_lcs</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">lac</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">c7sup</span><span class="p">),</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">c7</span> <span class="o">-</span> <span class="n">l5s1</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Thorax width (tw)</span>
    <span class="n">tw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">c7sup</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Local positions</span>
    <span class="n">local_c7t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
        <span class="n">c7t1_ratio</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">c7t1_angle</span><span class="p">)),</span>
        <span class="n">c7t1_ratio</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">c7t1_angle</span><span class="p">)),</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">]])</span>

    <span class="n">local_rgh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
        <span class="n">gh_ratio</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">gh_angle</span><span class="p">)),</span>
        <span class="n">gh_ratio</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">gh_angle</span><span class="p">)),</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">]])</span>

    <span class="n">local_lgh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
        <span class="n">gh_ratio</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">gh_angle</span><span class="p">)),</span>
        <span class="n">gh_ratio</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">gh_angle</span><span class="p">)),</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">]])</span>

    <span class="c1"># Return global positions</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy_data_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;C7T1JointCenter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
        <span class="n">local_c7t1</span><span class="p">,</span> <span class="n">c7_lcs</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterR&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
            <span class="n">local_rgh</span><span class="p">,</span> <span class="n">rac_lcs</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterL&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
            <span class="n">local_lgh</span><span class="p">,</span> <span class="n">lac_lcs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span>


<span class="k">def</span> <span class="nf">_infer_extremity_joint_centers</span><span class="p">(</span>
        <span class="n">markers</span><span class="p">:</span> <span class="n">TimeSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeries</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Infer extremity joint centers based on medial and lateral markers.&quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy_data_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowJointCenterR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralHumeralEpicondyleR&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialHumeralEpicondyleR&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowJointCenterL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralHumeralEpicondyleL&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialHumeralEpicondyleL&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;KneeJointCenterR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralFemoralEpicondyleR&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialFemoralEpicondyleR&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;KneeJointCenterL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralFemoralEpicondyleL&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialFemoralEpicondyleL&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristJointCenterR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristJointCenterL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidL&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UlnarStyloidL&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AnkleJointCenterR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralMalleolusR&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialMalleolusR&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AnkleJointCenterL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralMalleolusL&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialMalleolusL&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">output</span>


<div class="viewcode-block" id="track_local_coordinate_systems"><a class="viewcode-back" href="../../api/kineticstoolkit.anthropometrics.track_local_coordinate_systems.html#kineticstoolkit.anthropometrics.track_local_coordinate_systems">[docs]</a><span class="nd">@unstable</span>
<span class="k">def</span> <span class="nf">track_local_coordinate_systems</span><span class="p">(</span>
        <span class="n">markers</span><span class="p">:</span> <span class="n">TimeSeries</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="n">segments</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeries</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create local coordinate system definitions based on static markers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    markers</span>
<span class="sd">        TimeSeries that contains marker trajectories as Nx4 during an action.</span>

<span class="sd">    segments</span>
<span class="sd">        Name of the segment. Can be &#39;Pelvis&#39;, &#39;Thorax&#39;, &#39;HeadNeck&#39;,</span>
<span class="sd">        &#39;ArmR&#39;, &#39;ArmL&#39;, &#39;ForearmR&#39;, &#39;ForearmL&#39;, &#39;HandR&#39;, &#39;HandL&#39;, &#39;ThighR&#39;,</span>
<span class="sd">        &#39;ThighL&#39;, &#39;LegR&#39;, &#39;LegL&#39;, &#39;FootR&#39;, or &#39;FootL&#39;. An empty string or</span>
<span class="sd">        an empty list will try to process every segment.</span>

<span class="sd">    method</span>
<span class="sd">        Optional. Select one ot both methods to reconstruct the axial</span>
<span class="sd">        orientation of the arm as proposed by the ISB: 1 to use both humeral</span>
<span class="sd">        epicondyles, 2 to use the elbow center and the ulnar styloid. The</span>
<span class="sd">        default is 1. This parameter is ignored for segments other than</span>
<span class="sd">        ArmR and ArmL.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    TimeSeries</span>
<span class="sd">        A TimeSeries that contains the segments&#39; local position and orientation</span>
<span class="sd">        as series of Nx4x4 frames.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy_data_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># If we have no segment or an empty list, go with every segment</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Pelvis&#39;</span><span class="p">,</span> <span class="s1">&#39;Thorax&#39;</span><span class="p">,</span> <span class="s1">&#39;HeadNeck&#39;</span><span class="p">,</span> <span class="s1">&#39;ArmR&#39;</span><span class="p">,</span> <span class="s1">&#39;ArmL&#39;</span><span class="p">,</span> <span class="s1">&#39;ForearmR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ForearmL&#39;</span><span class="p">,</span> <span class="s1">&#39;HandR&#39;</span><span class="p">,</span> <span class="s1">&#39;HandL&#39;</span><span class="p">,</span> <span class="s1">&#39;ThighR&#39;</span><span class="p">,</span> <span class="s1">&#39;ThighL&#39;</span><span class="p">,</span> <span class="s1">&#39;LegR&#39;</span><span class="p">,</span> <span class="s1">&#39;LegL&#39;</span><span class="p">,</span>
            <span class="s1">&#39;FootR&#39;</span><span class="p">,</span> <span class="s1">&#39;FootL&#39;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="c1"># If we have a list of segments</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">track_local_coordinate_systems</span><span class="p">(</span>
                    <span class="n">markers</span><span class="p">,</span>
                    <span class="n">segment</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">method</span>
                <span class="p">),</span>
                <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="c1"># If we have a single segment</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span>

    <span class="k">if</span> <span class="n">segment</span> <span class="o">==</span> <span class="s1">&#39;Pelvis&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rasis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineR&#39;</span><span class="p">]</span>
            <span class="n">lasis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineL&#39;</span><span class="p">]</span>
            <span class="n">rpsis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineR&#39;</span><span class="p">]</span>
            <span class="n">lpsis</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineL&#39;</span><span class="p">]</span>
            <span class="n">l5s1</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;L5S1JointCenter&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the pelvis coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">mpsis</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">rpsis</span> <span class="o">+</span> <span class="n">lpsis</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">l5s1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="n">rasis</span> <span class="o">-</span> <span class="n">lasis</span><span class="p">),</span>
            <span class="n">xz</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">rasis</span> <span class="o">+</span> <span class="n">lasis</span><span class="p">)</span> <span class="o">-</span> <span class="n">mpsis</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="o">==</span> <span class="s1">&#39;Thorax&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c7t1</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;C7T1JointCenter&#39;</span><span class="p">]</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Suprasternale&#39;</span><span class="p">]</span>
            <span class="n">l5s1</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;L5S1JointCenter&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the thorax coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">c7t1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">c7t1</span> <span class="o">-</span> <span class="n">l5s1</span><span class="p">),</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">sup</span> <span class="o">-</span> <span class="n">l5s1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="o">==</span> <span class="s1">&#39;HeadNeck&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c7t1</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;C7T1JointCenter&#39;</span><span class="p">]</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sellion&#39;</span><span class="p">]</span>
            <span class="n">hv</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HeadVertex&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the thorax coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">c7t1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">hv</span> <span class="o">-</span> <span class="n">c7t1</span><span class="p">),</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">sel</span> <span class="o">-</span> <span class="n">c7t1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ArmR&#39;</span><span class="p">,</span> <span class="s1">&#39;ArmL&#39;</span><span class="p">]:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elbow_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ElbowJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">gh</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;GlenohumeralJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">r_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralHumeralEpicondyleR&#39;</span><span class="p">]</span>
                <span class="n">l_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialHumeralEpicondyleR&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="n">r_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialHumeralEpicondyleL&#39;</span><span class="p">]</span>
                <span class="n">l_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralHumeralEpicondyleL&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;side must be either &#39;R&#39; or &#39;L&#39;&quot;</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the arm coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">gh</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">gh</span> <span class="o">-</span> <span class="n">elbow_center</span><span class="p">),</span>
            <span class="n">yz</span><span class="o">=</span><span class="p">(</span><span class="n">r_ep</span> <span class="o">-</span> <span class="n">l_ep</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ForearmR&#39;</span><span class="p">,</span> <span class="s1">&#39;ForearmL&#39;</span><span class="p">]:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elbow_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ElbowJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">wrist_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;WristJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">r_st</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>
                <span class="n">l_st</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="n">r_st</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UlnarStyloidL&#39;</span><span class="p">]</span>
                <span class="n">l_st</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidL&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;side must be either &#39;R&#39; or &#39;L&#39;&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the forearm coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">elbow_center</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">elbow_center</span> <span class="o">-</span> <span class="n">wrist_center</span><span class="p">),</span>
            <span class="n">yz</span><span class="o">=</span><span class="p">(</span><span class="n">r_st</span> <span class="o">-</span> <span class="n">l_st</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HandR&#39;</span><span class="p">,</span> <span class="s1">&#39;HandL&#39;</span><span class="p">]:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wrist_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;WristJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">r_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CarpalMetaHead2R&#39;</span><span class="p">]</span>
                <span class="n">l_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CarpalMetaHead5R&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="n">r_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CarpalMetaHead5L&#39;</span><span class="p">]</span>
                <span class="n">l_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CarpalMetaHead2L&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;side must be either &#39;R&#39; or &#39;L&#39;&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the hand coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">meta_center</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">r_meta</span> <span class="o">+</span> <span class="n">l_meta</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">wrist_center</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">wrist_center</span> <span class="o">-</span> <span class="n">meta_center</span><span class="p">),</span>
            <span class="n">yz</span><span class="o">=</span><span class="p">(</span><span class="n">r_meta</span> <span class="o">-</span> <span class="n">l_meta</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ThighR&#39;</span><span class="p">,</span> <span class="s1">&#39;ThighL&#39;</span><span class="p">]:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hip_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;HipJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">knee_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;KneeJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">r_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralFemoralEpicondyleR&#39;</span><span class="p">]</span>
                <span class="n">l_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialFemoralEpicondyleR&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="n">r_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialFemoralEpicondyleL&#39;</span><span class="p">]</span>
                <span class="n">l_ep</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralFemoralEpicondyleL&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;side must be either &#39;R&#39; or &#39;L&#39;&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the thigh coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">hip_center</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">hip_center</span> <span class="o">-</span> <span class="n">knee_center</span><span class="p">),</span>
            <span class="n">yz</span><span class="o">=</span><span class="p">(</span><span class="n">r_ep</span> <span class="o">-</span> <span class="n">l_ep</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;LegR&#39;</span><span class="p">,</span> <span class="s1">&#39;LegL&#39;</span><span class="p">]:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">knee_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;KneeJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">ankle_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;AnkleJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">r_mal</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralMalleolusR&#39;</span><span class="p">]</span>
                <span class="n">l_mal</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialMalleolusR&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="n">r_mal</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialMalleolusL&#39;</span><span class="p">]</span>
                <span class="n">l_mal</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralMalleolusL&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;side must be either &#39;R&#39; or &#39;L&#39;&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the leg coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">knee_center</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">knee_center</span> <span class="o">-</span> <span class="n">ankle_center</span><span class="p">),</span>
            <span class="n">yz</span><span class="o">=</span><span class="p">(</span><span class="n">r_mal</span> <span class="o">-</span> <span class="n">l_mal</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">segment</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;FootR&#39;</span><span class="p">,</span> <span class="s1">&#39;FootL&#39;</span><span class="p">]:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ankle_center</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;AnkleJointCenter</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">calc</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Calcaneus</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">r_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TarsalMetaHead5R&#39;</span><span class="p">]</span>
                <span class="n">l_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TarsalMetaHead1R&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="n">r_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TarsalMetaHead1L&#39;</span><span class="p">]</span>
                <span class="n">l_meta</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TarsalMetaHead5L&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;side must be either &#39;R&#39; or &#39;L&#39;&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Not enough markers to create the foot coordinate system.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Create the local coordinate system</span>
        <span class="n">meta_center</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">r_meta</span> <span class="o">+</span> <span class="n">l_meta</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">ankle_center</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">meta_center</span> <span class="o">-</span> <span class="n">calc</span><span class="p">),</span>
            <span class="n">xz</span><span class="o">=</span><span class="p">(</span><span class="n">r_meta</span> <span class="o">-</span> <span class="n">l_meta</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="estimate_center_of_mass"><a class="viewcode-back" href="../../api/kineticstoolkit.anthropometrics.estimate_center_of_mass.html#kineticstoolkit.anthropometrics.estimate_center_of_mass">[docs]</a><span class="nd">@unstable</span>
<span class="k">def</span> <span class="nf">estimate_center_of_mass</span><span class="p">(</span>
        <span class="n">markers</span><span class="p">:</span> <span class="n">TimeSeries</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="n">segments</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeries</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate the segments&#39; center of mass based on anthropometric data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    markers</span>
<span class="sd">        TimeSeries that contains marker trajectories as Nx4 during an action.</span>

<span class="sd">    segments</span>
<span class="sd">        Name of the segment. Can be &#39;Pelvis&#39;, &#39;Thorax&#39;, &#39;HeadNeck&#39;,</span>
<span class="sd">        &#39;ArmR&#39;, &#39;ArmL&#39;, &#39;ForearmR&#39;, &#39;ForearmL&#39;, &#39;HandR&#39;, &#39;HandL&#39;, &#39;ThighR&#39;,</span>
<span class="sd">        &#39;ThighL&#39;, &#39;LegR&#39;, &#39;LegL&#39;, &#39;FootR&#39;, or &#39;FootL&#39;. An empty string or</span>
<span class="sd">        an empty list will try to process every segment.</span>

<span class="sd">    sex</span>
<span class="sd">        Optional. Either &#39;M&#39; or &#39;F&#39;. The default is &#39;M&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    TimeSeries</span>
<span class="sd">        A TimeSeries with the trajectory of the segments&#39; centers of mass,</span>
<span class="sd">        named {segment}CenterOfMass.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># We will add markers to it so copy it first.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy_data_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># If we have no segment or an empty list, go with every segment</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Pelvis&#39;</span><span class="p">,</span> <span class="s1">&#39;Thorax&#39;</span><span class="p">,</span> <span class="s1">&#39;HeadNeck&#39;</span><span class="p">,</span> <span class="s1">&#39;ArmR&#39;</span><span class="p">,</span> <span class="s1">&#39;ArmL&#39;</span><span class="p">,</span> <span class="s1">&#39;ForearmR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ForearmL&#39;</span><span class="p">,</span> <span class="s1">&#39;HandR&#39;</span><span class="p">,</span> <span class="s1">&#39;HandL&#39;</span><span class="p">,</span> <span class="s1">&#39;ThighR&#39;</span><span class="p">,</span> <span class="s1">&#39;ThighL&#39;</span><span class="p">,</span> <span class="s1">&#39;LegR&#39;</span><span class="p">,</span> <span class="s1">&#39;LegL&#39;</span><span class="p">,</span>
            <span class="s1">&#39;FootR&#39;</span><span class="p">,</span> <span class="s1">&#39;FootL&#39;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="c1"># If we have a list of segments</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">estimate_center_of_mass</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">segment</span><span class="p">),</span>
                <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="c1"># From here we have a single segment</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span>

    <span class="c1"># Decompose segment name and side</span>
    <span class="k">if</span> <span class="n">segment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">,</span> <span class="s1">&#39;Thorax&#39;</span><span class="p">,</span> <span class="s1">&#39;HeadNeck&#39;</span><span class="p">]:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Calculate the local coordinate system for this segment</span>
    <span class="n">lcs</span> <span class="o">=</span> <span class="n">track_local_coordinate_systems</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="p">(</span><span class="n">segment</span> <span class="o">+</span> <span class="n">side</span><span class="p">))</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">INERTIAL_VALUES</span><span class="p">[</span><span class="s1">&#39;Dumas2007&#39;</span><span class="p">]</span>
    <span class="c1"># Search the inertial value tables for the given segment and sex</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Segment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sex</span><span class="p">)]</span>
    <span class="n">constants</span> <span class="o">=</span> <span class="n">_</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Add possible missing markers</span>
    <span class="k">if</span> <span class="s1">&#39;ProjectedHipJointCenter&#39;</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint1&#39;</span><span class="p">],</span>
        <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint2&#39;</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="c1"># Calculate ProjectedHipJointCenter</span>
        <span class="n">local_rhip</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">],</span>
            <span class="n">lcs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">])</span>
        <span class="n">local_rhip</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Projection in sagittal plane</span>
        <span class="n">local_lhip</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">],</span>
            <span class="n">lcs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">])</span>
        <span class="n">local_lhip</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Projection in sagittal plane</span>
        <span class="n">local_hips</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">local_rhip</span> <span class="o">+</span> <span class="n">local_lhip</span><span class="p">)</span>

        <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProjectedHipJointCenter&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span><span class="n">local_hips</span><span class="p">,</span> <span class="n">lcs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Pelvis&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;CarpalMetaHeadM25&#39;</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint1&#39;</span><span class="p">],</span>
        <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint2&#39;</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="c1"># Calculate midpoint of carpal meat head 2 and 5</span>
        <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;CarpalMetaHeadM25</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;CarpalMetaHead2</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;CarpalMetaHead5</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;TarsalMetaHeadM15&#39;</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint1&#39;</span><span class="p">],</span>
        <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint2&#39;</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="c1"># Calculate midpoint of carpal meat head 2 and 5</span>
        <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;TarsalMetaHeadM15</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;TarsalMetaHead1</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;TarsalMetaHead5</span><span class="si">{</span><span class="n">side</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Calculate the segment length</span>
    <span class="n">segment_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">side</span><span class="p">]</span>
                <span class="o">-</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">constants</span><span class="p">[</span><span class="s1">&#39;LengthPoint1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">side</span><span class="p">],</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Add COM output</span>
    <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">segment</span><span class="si">}{</span><span class="n">side</span><span class="si">}</span><span class="s1">CenterOfMass&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
                <span class="n">segment_length</span> <span class="o">*</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;RelComX&#39;</span><span class="p">],</span>
                <span class="n">segment_length</span> <span class="o">*</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;RelComY&#39;</span><span class="p">],</span>
                <span class="n">segment_length</span> <span class="o">*</span> <span class="n">constants</span><span class="p">[</span><span class="s1">&#39;RelComZ&#39;</span><span class="p">],</span>
                <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">]]),</span>
            <span class="n">lcs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">segment</span> <span class="o">+</span> <span class="n">side</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="estimate_global_center_of_mass"><a class="viewcode-back" href="../../api/kineticstoolkit.anthropometrics.estimate_global_center_of_mass.html#kineticstoolkit.anthropometrics.estimate_global_center_of_mass">[docs]</a><span class="nd">@unstable</span>
<span class="k">def</span> <span class="nf">estimate_global_center_of_mass</span><span class="p">(</span>
        <span class="n">coms</span><span class="p">:</span> <span class="n">TimeSeries</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeries</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate the global center of mass.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coms</span>
<span class="sd">        A TimeSeries with the trajectory of every segment&#39;s center of mass.</span>
<span class="sd">        The segments must be in this list: &#39;PelvisCenterOfMass&#39;,</span>
<span class="sd">        &#39;ThoraxCenterOfMass&#39;, &#39;HeadNeckCenterOfMass&#39;,</span>
<span class="sd">        &#39;ArmRCenterOfMass&#39;, &#39;ArmLCenterOfMass&#39;,</span>
<span class="sd">        &#39;ForearmRCenterOfMass&#39;, &#39;ForearmLCenterOfMass&#39;,</span>
<span class="sd">        &#39;HandRCenterOfMass&#39;, &#39;HandLCenterOfMass&#39;,</span>
<span class="sd">        &#39;ThighRCenterOfMass&#39;, &#39;ThighLCenterOfMass&#39;,</span>
<span class="sd">        &#39;LegRCenterOfMass&#39;, &#39;LegLCenterOfMass&#39;,</span>
<span class="sd">        &#39;FootRCenterOfMass&#39;, &#39;FootLCenterOfMass&#39;.</span>
<span class="sd">    sex</span>
<span class="sd">        Optional. Either &#39;M&#39; or &#39;F&#39;. The default is &#39;M&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ktk.TimeSeries</span>
<span class="sd">        A TimeSeries with a single element named &#39;GlobalCenterOfMass&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inertial_data</span> <span class="o">=</span> <span class="n">INERTIAL_VALUES</span><span class="p">[</span><span class="s1">&#39;Dumas2007&#39;</span><span class="p">]</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">coms</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy_data_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;GlobalCenterOfMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">out</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">])</span>

    <span class="n">cumulative_mass</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">coms</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">segment_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;CenterOfMass&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">segment_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Thorax&#39;</span><span class="p">,</span> <span class="s1">&#39;HeadNeck&#39;</span><span class="p">,</span> <span class="s1">&#39;Pelvis&#39;</span><span class="p">]:</span>
            <span class="c1"># The segment name is terminated by L or R. Remove it.</span>
            <span class="n">segment_name</span> <span class="o">=</span> <span class="n">segment_name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">segment_rel_mass</span> <span class="o">=</span> <span class="n">inertial_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">inertial_data</span><span class="p">[</span><span class="s1">&#39;Segment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment_name</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">inertial_data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sex</span><span class="p">),</span>
            <span class="s1">&#39;RelMass&#39;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment_rel_mass</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;GlobalCenterOfMass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">segment_rel_mass</span><span class="p">)</span> <span class="o">*</span> <span class="n">coms</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">cumulative_mass</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">segment_rel_mass</span><span class="p">)</span>

    <span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;GlobalCenterOfMass&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">cumulative_mass</span>
    <span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;GlobalCenterOfMass&#39;</span><span class="p">][:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">out</span></div>


<span class="c1"># %% Constants</span>

<span class="c1">#: A link model to help kinematics visualization</span>
<span class="n">LINKS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Pelvis&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineR&#39;</span><span class="p">,</span> <span class="s1">&#39;AnteriorSuperiorIliacSpineL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineL&#39;</span><span class="p">,</span> <span class="s1">&#39;PosteriorSuperiorIliacSpineL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineL&#39;</span><span class="p">,</span> <span class="s1">&#39;PosteriorSuperiorIliacSpineR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineR&#39;</span><span class="p">,</span> <span class="s1">&#39;AnteriorSuperiorIliacSpineR&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineR&#39;</span><span class="p">,</span> <span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineR&#39;</span><span class="p">,</span> <span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineL&#39;</span><span class="p">,</span> <span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;PosteriorSuperiorIliacSpineL&#39;</span><span class="p">,</span> <span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineR&#39;</span><span class="p">,</span> <span class="s1">&#39;PubicSymphysis&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;AnteriorSuperiorIliacSpineL&#39;</span><span class="p">,</span> <span class="s1">&#39;PubicSymphysis&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;PubicSymphysis&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;PubicSymphysis&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;Trunk&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;L5S1JointCenter&#39;</span><span class="p">,</span> <span class="s1">&#39;C7T1JointCenter&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;C7&#39;</span><span class="p">,</span> <span class="s1">&#39;GlenohumeralJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;C7&#39;</span><span class="p">,</span> <span class="s1">&#39;GlenohumeralJointCenterL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Suprasternale&#39;</span><span class="p">,</span> <span class="s1">&#39;GlenohumeralJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Suprasternale&#39;</span><span class="p">,</span> <span class="s1">&#39;GlenohumeralJointCenterL&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;C7&#39;</span><span class="p">,</span> <span class="s1">&#39;AcromionR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;C7&#39;</span><span class="p">,</span> <span class="s1">&#39;AcromionL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Suprasternale&#39;</span><span class="p">,</span> <span class="s1">&#39;AcromionR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Suprasternale&#39;</span><span class="p">,</span> <span class="s1">&#39;AcromionL&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;AcromionR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;AcromionL&#39;</span><span class="p">],</span>

        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;HeadNeck&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;Sellion&#39;</span><span class="p">,</span> <span class="s1">&#39;C7T1JointCenter&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HeadVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;C7T1JointCenter&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Sellion&#39;</span><span class="p">,</span> <span class="s1">&#39;HeadVertex&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;UpperArms&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralHumeralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialHumeralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralHumeralEpicondyleR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialHumeralEpicondyleR&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowJointCenterL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralHumeralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;GlenohumeralJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialHumeralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralHumeralEpicondyleL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialHumeralEpicondyleL&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;Forearms&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;ElbowJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;WristJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralHumeralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialHumeralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;ElbowJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;WristJointCenterL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;RadialStyloidL&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralHumeralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;UlnarStyloidL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialHumeralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;RadialStyloidL&#39;</span><span class="p">,</span> <span class="s1">&#39;UlnarStyloidL&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;Hands&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;CarpalMetaHead2R&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;CarpalMetaHead5R&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CarpalMetaHead2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CarpalMetaHead5R&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;RadialStyloidL&#39;</span><span class="p">,</span> <span class="s1">&#39;CarpalMetaHead2L&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;UlnarStyloidL&#39;</span><span class="p">,</span> <span class="s1">&#39;CarpalMetaHead5L&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CarpalMetaHead2L&#39;</span><span class="p">,</span> <span class="s1">&#39;CarpalMetaHead5L&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;Tighs&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;KneeJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralFemoralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialFemoralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralFemoralEpicondyleR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialFemoralEpicondyleR&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;KneeJointCenterL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralFemoralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;HipJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialFemoralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralFemoralEpicondyleL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialFemoralEpicondyleL&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;Legs&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;AnkleJointCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;KneeJointCenterR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralMalleolusR&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralFemoralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;MedialMalleolusR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialFemoralEpicondyleR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralMalleolusR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialMalleolusR&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;AnkleJointCenterL&#39;</span><span class="p">,</span> <span class="s1">&#39;KneeJointCenterL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralMalleolusL&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralFemoralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;MedialMalleolusL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialFemoralEpicondyleL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralMalleolusL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialMalleolusL&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;Feets&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;CalcaneusR&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead1R&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CalcaneusR&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead5R&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;MedialMalleolusR&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead1R&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralMalleolusR&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead5R&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CalcaneusR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialMalleolusR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CalcaneusR&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralMalleolusR&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;TarsalMetaHead1R&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead5R&#39;</span><span class="p">],</span>

            <span class="p">[</span><span class="s1">&#39;CalcaneusL&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead1L&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CalcaneusL&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead5L&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;MedialMalleolusL&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead1L&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;LateralMalleolusL&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead5L&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CalcaneusL&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialMalleolusL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;CalcaneusL&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralMalleolusL&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;TarsalMetaHead1L&#39;</span><span class="p">,</span> <span class="s1">&#39;TarsalMetaHead5L&#39;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>


<span class="c1"># Load Inertial Values</span>
<span class="n">INERTIAL_VALUES</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Dumas2007</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">root_folder</span> <span class="o">+</span> <span class="s1">&#39;/data/anthropometrics_dumas_2007.csv&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="p">[[</span><span class="s1">&#39;RelIXY&#39;</span><span class="p">,</span> <span class="s1">&#39;RelIXZ&#39;</span><span class="p">,</span> <span class="s1">&#39;RelIYZ&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">_</span><span class="p">[[</span><span class="s1">&#39;RelIXY&#39;</span><span class="p">,</span> <span class="s1">&#39;RelIXZ&#39;</span><span class="p">,</span> <span class="s1">&#39;RelIYZ&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">complex</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">INERTIAL_VALUES</span><span class="p">[</span><span class="s1">&#39;Dumas2007&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_</span>


<span class="n">module_locals</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>


<span class="k">def</span> <span class="fm">__dir__</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">directory</span><span class="p">(</span><span class="n">module_locals</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>

    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>