
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculating joint angles from a kinematic acquisition &mdash; Kinetics Toolkit</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="_static/sphinx-thebe.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/stable.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/togglebutton.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
        <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
        <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
        <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
        <script async="async" src="_static/sphinx-thebe.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reconstructing occluded markers" href="kinematics_reconstructing_occluded_markers.html" />
    <link rel="prev" title="Reading and visualizing marker trajectories" href="kinematics_load_visualize.html" />


 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
            <a href="index.html">
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started_ktk.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="timeseries.html">TimeSeries</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadsave.html">Saving and loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html">Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="cycles.html">Detecting and normalizing cycles</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry.html">Rigid body geometry</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="kinematics.html">Kinematics analysis</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="kinematics_load_visualize.html">Reading and visualizing marker trajectories</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Calculating joint angles from a kinematic acquisition</a></li>
<li class="toctree-l3"><a class="reference internal" href="kinematics_reconstructing_occluded_markers.html">Reconstructing occluded markers</a></li>
<li class="toctree-l3"><a class="reference internal" href="kinematics_reconstructing_removed_markers.html">Reconstructing removed markers</a></li>
<li class="toctree-l3"><a class="reference internal" href="kinematics_reconstructing_probed_points.html">Reconstructing probed points</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pushrimkinetics.html">Wheelchair kinetics</a></li>
<li class="toctree-l2"><a class="reference internal" href="ktk_conventions.html">Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ktk_in_depth.html">In depth</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="99_api_reference/01_classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="99_api_reference/02_functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="99_api_reference/03_modules.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/felixchenier/kineticstoolkit">GitHub repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
          <li><a href="kinematics.html">Kinematics analysis</a> &raquo;</li>
      <li>Calculating joint angles from a kinematic acquisition</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/kinematics_joint_angles.md" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="kinematics_load_visualize.html" class="btn btn-neutral float-left" title="Reading and visualizing marker trajectories" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="kinematics_reconstructing_occluded_markers.html" class="btn btn-neutral float-right" title="Reconstructing occluded markers" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="tex2jax_ignore mathjax_ignore section" id="calculating-joint-angles-from-a-kinematic-acquisition">
<h1>Calculating joint angles from a kinematic acquisition<a class="headerlink" href="#calculating-joint-angles-from-a-kinematic-acquisition" title="Permalink to this headline"></a></h1>
<p>In this tutorial, we will calculate the elbow joint angles in the acquisition presented in the previous section. At the end of the tutorial, we will plot curves of elbow flexion and pronation angles during the complete acquisition.</p>
<p>Such an analysis is composed of the following steps:</p>
<p><strong>Step 1.</strong> Read the marker trajectories.</p>
<p><strong>Step 2.</strong> We calculate a series of frames that express the orientation of all segments that compose the analyzed joints (how are both segments oriented in space). Here, we calculate frame series for the forearm and arm.</p>
<p><strong>Step 3.</strong> We express a series of homogeneous transforms between the proximal and distal frames (how the distal segment is oriented in space compared to the proximal segment);</p>
<p><strong>Step 4.</strong> We extract the series of Euler angles from these homogeneous transforms (what series of three angles allow such relative orientation);</p>
<p><strong>Step 5.</strong> We interpret these Euler angle as rotations around anatomical axes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">kineticstoolkit.lab</span> <span class="k">as</span> <span class="nn">ktk</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="read-and-visualize-marker-trajectories">
<h2>Read and visualize marker trajectories<a class="headerlink" href="#read-and-visualize-marker-trajectories" title="Permalink to this headline"></a></h2>
<p>We proceed exactly as in the previous tutorial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read the markers</span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">kinematics</span><span class="o">.</span><span class="n">read_c3d_file</span><span class="p">(</span>
    <span class="n">ktk</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;kinematics_racing_full.c3d&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Set the point of view for 3D visualization</span>
<span class="n">viewing_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;zoom&#39;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
    <span class="s1">&#39;azimuth&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="s1">&#39;elevation&#39;</span><span class="p">:</span> <span class="mf">0.16</span><span class="p">,</span>
    <span class="s1">&#39;translation&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Interconnect markers for easier visualization</span>
<span class="n">interconnections</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ArmR&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;AcromionR&#39;</span><span class="p">,</span> <span class="s1">&#39;MedialEpicondyleR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;AcromionR&#39;</span><span class="p">,</span> <span class="s1">&#39;LateralEpicondyleR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;AcromionR&#39;</span><span class="p">,</span> <span class="s1">&#39;OlecraneR&#39;</span><span class="p">]]</span>
    <span class="p">},</span>
    <span class="s1">&#39;ForearmR&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;Links&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;MedialEpicondyleR&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;MedialEpicondyleR&#39;</span><span class="p">,</span> <span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;LateralEpicondyleR&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;LateralEpicondyleR&#39;</span><span class="p">,</span> <span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;OlecraneR&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;OlecraneR&#39;</span><span class="p">,</span> <span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Create the player</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">Player</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">interconnections</span><span class="o">=</span><span class="n">interconnections</span><span class="p">,</span> <span class="o">**</span><span class="n">viewing_options</span><span class="p">)</span>

<span class="c1"># Show one second (only needed in Notebooks)</span>
<span class="n">player</span><span class="o">.</span><span class="n">to_html5</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop_time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-local-coordinate-systems">
<h2>Create local coordinate systems<a class="headerlink" href="#create-local-coordinate-systems" title="Permalink to this headline"></a></h2>
<p>To calculate the elbow angles, we need to express frames for the arm and forearm segments. The elbow angles will be extracted from the homogeneous transform between both frames.</p>
<p>We will use the recommendations of the International Society of Biomechanics <a class="footnote-reference brackets" href="#id4" id="id1">1</a> to define these local coordinate systems:</p>
<div class="section" id="arm-coordinate-system">
<h3>Arm coordinate system<a class="headerlink" href="#arm-coordinate-system" title="Permalink to this headline"></a></h3>
<p>Following the ISB recommendations, the local coordinate system for the humerus is defined as follow:</p>
<p><strong>1. The origin is GH (glenohumeral joint).</strong></p>
<p>We don’t have a marker for the glenohumeral join, but we have one for the acromion. We will approximate GH by the acromion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">origin</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AcromionR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>2. The y axis is the line between GH and the midpoint of EL (lateral elbow epicondyle) and EM (medial elbow epicondyle), pointing to GH</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AcromionR&#39;</span><span class="p">]</span> <span class="o">-</span>
     <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralEpicondyleR&#39;</span><span class="p">]</span> <span class="o">+</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialEpicondyleR&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>3. The x axis is the normal to the GH-EL-EM plane, pointing forward</strong></p>
<p>Since x is normal to the GH-EL-EM plane, this plane is a yz plane. We need to define a second vector (other than y) to form this yz plane.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yz</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralEpicondyleR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialEpicondyleR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the direction of the yz vector is important. For the plane normal to be forward, the cross product of y and yz must also point forward. In this case, following the <a class="reference external" href="https://en.wikipedia.org/wiki/Right-hand_rule">right-hand/screw rule</a>, y (upward) cross yz (right) effectively yields a forward vector.</p>
<p>As an easier rule of thumb, look at the next definition: the z vector will point to right. Then just make the yz vector also point to (grossly) right.</p>
<p><strong>4. The z axis is perpendicular to x and y, pointing to the right.</strong></p>
<p>We have now defined everything to create the series of humerus frame.</p>
<p>We first create an empty TimeSeries for our frames:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will create the <code class="docutils literal notranslate"><span class="pre">ArmR</span></code> frame series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ArmR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">yz</span><span class="o">=</span><span class="n">yz</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s visualize it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">player</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">Player</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span>
                    <span class="n">interconnections</span><span class="o">=</span><span class="n">interconnections</span><span class="p">,</span> <span class="o">**</span><span class="n">viewing_options</span><span class="p">)</span>

<span class="c1"># Show one second in this Jupyter notebook</span>
<span class="n">player</span><span class="o">.</span><span class="n">to_html5</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop_time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="forearm-frame">
<h3>Forearm frame<a class="headerlink" href="#forearm-frame" title="Permalink to this headline"></a></h3>
<p>We will now proceed with the exact same steps to create the forearm coordinate system. From the ISB <a class="footnote-reference brackets" href="#id4" id="id2">1</a> :</p>
<p><strong>1. The origin is US (ulnar styloid process).</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">origin</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>2. The y axis is the line between US and the midpoint between EL and EM, pointing proximally.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LateralEpicondyleR&#39;</span><span class="p">]</span> <span class="o">+</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MedialEpicondyleR&#39;</span><span class="p">])</span> <span class="o">-</span>
     <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p><strong>3. The x axis is the line perpendicular to the plane through US, RS, and the midpoint between EL and EM, pointing forward.</strong></p>
<p><strong>4. The z axis is perpendicular to x and y, pointing to the right.</strong></p>
<p>This means that US, RS and the elbow center make an yz plane. Since z will point to the right in anatomical position, we will create a yz vector that points grossly to the right in anatomical position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yz</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">markers</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;UlnarStyloidR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We are now ready to create the <code class="docutils literal notranslate"><span class="pre">ForearmR</span></code> frame series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForearmR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">create_frames</span><span class="p">(</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">yz</span><span class="o">=</span><span class="n">yz</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s visualize our markers with both new frames:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">player</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">Player</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span>
                    <span class="n">interconnections</span><span class="o">=</span><span class="n">interconnections</span><span class="p">,</span> <span class="o">**</span><span class="n">viewing_options</span><span class="p">)</span>

<span class="c1"># Show one second in this Jupyter notebook</span>
<span class="n">player</span><span class="o">.</span><span class="n">to_html5</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop_time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="find-the-series-of-homogeneous-transforms-between-both-segments">
<h2>Find the series of homogeneous transforms between both segments<a class="headerlink" href="#find-the-series-of-homogeneous-transforms-between-both-segments" title="Permalink to this headline"></a></h2>
<p>Now that we have expressed frames for both the arm and forearm, we can find the homogeneous transform between both frames. This is equivalent to expressing the forearm frame in the local coordinates system of the arm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arm_to_forearm</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForearmR&#39;</span><span class="p">],</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ArmR&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">arm_to_forearm</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="extract-the-series-of-euler-angles">
<h2>Extract the series of Euler angles<a class="headerlink" href="#extract-the-series-of-euler-angles" title="Permalink to this headline"></a></h2>
<p>We now have a series of homogeneous matrices, from which we will now extract Euler angles corresponding to flexion and pronation. We will use the <a class="reference internal" href="api/kineticstoolkit.geometry.get_angles.html"><span class="doc std std-doc">geometry.get_angles()</span></a> function to extract these Euler angles. We however fist need to define the sequence of rotation for these angles. Still following the recommendations of the International Society of Biomechanics <a class="footnote-reference brackets" href="#id4" id="id3">1</a>, we define the series of rotations from the arm to forearm as:</p>
<p><strong>First rotation:</strong> Around the humerus’ z axis. Corresponds to a flexion (positive) or hyperextension (negative).</p>
<p><strong>Second rotation:</strong> Around the forearm’s rotated x axis. Corresponds to a “carrying angle” due to a tilt in the humeral flexion/extension axis at the humero-ulnar joint and an angulation of the ulna itself.</p>
<p><strong>Third rotation:</strong> Around the forearm’s rotated y axis. Corresponds to a pronation (positive) or supination (negative).</p>
<p>These rotations are relative to moving axes (every other rotation is performed around a new frame generated by the previous rotation). Therefore, we will use ‘ZXY’ (capital letters - see <a class="reference internal" href="api/kineticstoolkit.geometry.get_angles.html"><span class="doc std std-doc">geometry.get_angles()</span></a> for the conventions) as the sequence of rotations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">euler_angles</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_angles</span><span class="p">(</span><span class="n">arm_to_forearm</span><span class="p">,</span> <span class="s1">&#39;ZXY&#39;</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">euler_angles</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-the-euler-angles">
<h2>Plot the Euler angles<a class="headerlink" href="#plot-the-euler-angles" title="Permalink to this headline"></a></h2>
<p>Now that we calculated the angles, we create a last TimeSeries that represents the meaning of these angles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">angles</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

<span class="n">angles</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Elbow flexion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">euler_angles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">angles</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forearm pronation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">euler_angles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>

<span class="n">angles</span> <span class="o">=</span> <span class="n">angles</span><span class="o">.</span><span class="n">add_data_info</span><span class="p">(</span><span class="s1">&#39;Elbow flexion&#39;</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">angles</span> <span class="o">=</span> <span class="n">angles</span><span class="o">.</span><span class="n">add_data_info</span><span class="p">(</span><span class="s1">&#39;Forearm pronation&#39;</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>

<span class="n">angles</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>From this curve, we can now see that the elbow goes from a total extension to a flexion of about 100 degrees, while the forearm stays in a pronated angle of about 125 to 170 degrees (defined from a fully supinated position in anatomical position).</p>
<p>The process would be identical for any joint:</p>
<ol class="simple">
<li><p>Create the series of reference frames for the two segments that compose the analyzed joint;</p></li>
<li><p>Express the series of rigid transforms from the proximal to distal joint;</p></li>
<li><p>Extract the series of Euler angles from these rigid transforms;</p></li>
<li><p>Interpret these Euler angle as anatomical rotation.</p></li>
</ol>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>,<a href="#id3">3</a>)</span></dt>
<dd><p>G. Wu et al., “ISB recommendation on definitions of joint coordinate systems of various joints for the reporting of human joint motion - Part II: shoulder, elbow, wrist and hand,” Journal of Biomechanics, vol. 38, no. 5, pp. 981–992, 2005.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="kinematics_load_visualize.html" class="btn btn-neutral float-left" title="Reading and visualizing marker trajectories" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="kinematics_reconstructing_occluded_markers.html" class="btn btn-neutral float-right" title="Reconstructing occluded markers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>