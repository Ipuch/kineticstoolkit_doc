
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inverse Dynamics &mdash; Kinetics Toolkit (dev) master documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="prev" title="Anthropometrics" href="../02_anthropometrics/index.html" />


 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
            <a href="../../../index.html">
            <img src="../../../_static/logo_development.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">GETTING STARTED</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../01_getting_started/01_what_is_kinetics_toolkit.html">What is Kinetics Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../01_getting_started/02_install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../01_getting_started/03_conventions.html">Conventions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TUTORIALS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../02_tutorials/01_timeseries/index.html">TimeSeries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../02_tutorials/02_loadsave/index.html">Saving and loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../02_tutorials/03_filters/index.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../02_tutorials/04_cycles/index.html">Detecting and normalizing cycles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../02_tutorials/05_geometry/index.html">Rigid body geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../02_tutorials/06_kinematics/index.html">Kinematics analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../02_tutorials/07_pushrimkinetics/index.html">Wheelchair kinetics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IN DEPTH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../03_in_depth/01_lab_mode.html">Lab mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../03_in_depth/02_release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://felixchenier.uqam.ca/ktk_develop">Development website</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/felixchenier/kineticstoolkit">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FOR DEVELOPERS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../01_getting_started/index.html">Developing Kinetics Toolkit</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial development for stable/unstable features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_reconstruction/index.html">Reconstructing virtual markers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_anthropometrics/index.html">Anthropometrics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Inverse Dynamics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-sample-data">Loading sample data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#put-everything-relevant-into-one-synchronized-timeseries">Put everything relevant into one, synchronized TimeSeries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-the-force-and-moments-at-the-wrist">Calculate the force and moments at the wrist</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#calculate-the-com-position-of-the-wheel-segment">Calculate the COM position of the wheel segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-the-com-acceleration-of-the-wheel-segment">Calculate the COM acceleration of the wheel segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-the-wheel-segment-s-angles-around-the-global-x-y-and-z-axes">Calculate the wheel segment’s angles around the global x, y and z axes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-the-segment-s-angular-velocity-and-acceleration-around-the-global-x-y-and-z-axes">Calculate the segment’s angular velocity and acceleration around the global x, y and z axes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finally-calculate-the-proximal-forces-and-moments">Finally, calculate the proximal forces and moments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-the-calculated-distal-forces-and-moments-to-the-ts-all-timeseries">Add the calculated distal forces and moments to the ts_all TimeSeries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-the-force-and-moments-at-the-elbow">Calculate the force and moments at the elbow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-the-force-and-moments-at-the-shoulder">Calculate the force and moments at the shoulder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-the-forces-and-moments-in-the-local-coordinate-system">Get the forces and moments in the local coordinate system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#local-forces">Local forces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#local-moments">Local moments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Kinetics Toolkit (dev)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Tutorial development for stable/unstable features</a> &raquo;</li>
      <li>Inverse Dynamics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="../02_anthropometrics/index.html" class="btn btn-neutral float-left" title="Anthropometrics" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="tex2jax_ignore mathjax_ignore section" id="inverse-dynamics">
<h1>Inverse Dynamics<a class="headerlink" href="#inverse-dynamics" title="Permalink to this headline"></a></h1>
<p>The <a class="reference internal" href="../../../api/kineticstoolkit.inversedynamics.html"><span class="doc std std-doc">inversedynamics</span></a> module calculates the proximal forces and moments based on the segment’s kinematics and distal forces and moments, based on the general method published in Dumas et al., 2004 <a class="footnote-reference brackets" href="#id2" id="id1">1</a>.</p>
<p>The results are the forces and moments applied by the distal segment on the
proximal articulation, in the global coordinates system.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an experimental module, its API and behaviour may change in the future. This module will be redesigned to make use of the <code class="docutils literal notranslate"><span class="pre">anthropometrics</span></code> module currently in development.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">kineticstoolkit.lab</span> <span class="k">as</span> <span class="nn">ktk</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="loading-sample-data">
<h2>Loading sample data<a class="headerlink" href="#loading-sample-data" title="Permalink to this headline"></a></h2>
<p>In this tutorial, we will load propulsion data from a sprint in Wheelchair Basketball. Kinetics were recorded using an instrumented wheel (SmartWheel) and kinematics were recorded using an optoelectronic system (Optitrack). Both are synchronized.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load kinetics</span>
<span class="n">kinetics</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">ktk</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">root_folder</span> <span class="o">+</span>
    <span class="s1">&#39;/data/inversedynamics/basketball_kinetics.ktk.zip&#39;</span><span class="p">)</span>

<span class="c1"># Change some signs to match (locally): x anterior, # y up, z lateral (right)</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Keep everything between sync and stop recording events.</span>
<span class="n">kinetics</span> <span class="o">=</span> <span class="n">kinetics</span><span class="o">.</span><span class="n">get_ts_between_events</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>

<span class="c1"># Look at the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Forces&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Moments&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_3_01.png" src="../../../_images/index_3_01.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load kinematics</span>
<span class="n">kinematics</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">ktk</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">root_folder</span> <span class="o">+</span>
    <span class="s1">&#39;/data/inversedynamics/basketball_kinematics.ktk.zip&#39;</span><span class="p">)[</span><span class="s1">&#39;Kinematics&#39;</span><span class="p">]</span>

<span class="c1"># Extract markers</span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">kinematics</span><span class="p">[</span><span class="s1">&#39;Markers&#39;</span><span class="p">]</span>
<span class="n">markers</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">kinetics</span><span class="o">.</span><span class="n">events</span>

<span class="c1"># Extract frames</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">kinematics</span><span class="p">[</span><span class="s1">&#39;ReferenceFrames&#39;</span><span class="p">]</span>
<span class="n">frames</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">kinetics</span><span class="o">.</span><span class="n">events</span>

<span class="c1"># Keep everything between sync and stop recording events.</span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">get_ts_between_events</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span><span class="o">.</span><span class="n">get_ts_between_events</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>

<span class="c1"># Plot one sample</span>
<span class="n">markers</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">)</span>

<span class="c1"># Check what markers are available</span>
<span class="n">markers</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                        &#39;Body_C7&#39;: &lt;array of shape (1210, 4)&gt;
                 &#39;Body_AcromionR&#39;: &lt;array of shape (1210, 4)&gt;
        &#39;Body_LateralEpicondyleR&#39;: &lt;array of shape (1210, 4)&gt;
                     &#39;Body_HandR&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
              &#39;RearWheelContactR&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;RearWheelCenterR&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;RearWheelTopR&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;BackwardRearAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;ForwardRearAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
    &#39;BackwardFrontAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;ForwardFrontAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;RearSeatR&#39;: &lt;array of shape (1210, 4)&gt;
                     &#39;FrontSeatR&#39;: &lt;array of shape (1210, 4)&gt;
                &#39;BackrestHeightR&#39;: &lt;array of shape (1210, 4)&gt;
             &#39;ExternalMalleolusR&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;FemoralLateralEpicondyleR&#39;: &lt;array of shape (1210, 4)&gt;
              &#39;RearWheelContactL&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;RearWheelCenterL&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;RearWheelTopL&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;BackwardRearAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;ForwardRearAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
    &#39;BackwardFrontAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;ForwardFrontAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;RearSeatL&#39;: &lt;array of shape (1210, 4)&gt;
                     &#39;FrontSeatL&#39;: &lt;array of shape (1210, 4)&gt;
                &#39;BackrestHeightL&#39;: &lt;array of shape (1210, 4)&gt;
             &#39;ExternalMalleolusL&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;FemoralLateralEpicondyleL&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta2R&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta5R&#39;: &lt;array of shape (1210, 4)&gt;
                 &#39;RadialStyloidR&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;UlnarStyloidR&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;OlecraneR&#39;: &lt;array of shape (1210, 4)&gt;
       &#39;HumeralMedialEpicondyleR&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta2L&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta5L&#39;: &lt;array of shape (1210, 4)&gt;
                 &#39;RadialStyloidL&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;UlnarStyloidL&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;OlecraneL&#39;: &lt;array of shape (1210, 4)&gt;
       &#39;HumeralMedialEpicondyleL&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;ElbowR&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;WheelchairCenter&#39;: &lt;array of shape (1210, 4)&gt;
    &#39;WheelchairAnteriorDirection&#39;: &lt;array of shape (1210, 4)&gt;
                           &#39;L5S1&#39;: &lt;array of shape (1210, 4)&gt;
}
</pre></div>
</div>
<img alt="../../../_images/index_4_1.png" src="../../../_images/index_4_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check what frames are available</span>
<span class="n">frames</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
    &#39;Wheelchair&#39;: &lt;array of shape (1210, 4, 4)&gt;
         &#39;Trunk&#39;: &lt;array of shape (1210, 4, 4)&gt;
        &#39;WheelL&#39;: &lt;array of shape (1210, 4, 4)&gt;
        &#39;WheelR&#39;: &lt;array of shape (1210, 4, 4)&gt;
      &#39;HumerusR&#39;: &lt;array of shape (1210, 4, 4)&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="put-everything-relevant-into-one-synchronized-timeseries">
<h2>Put everything relevant into one, synchronized TimeSeries<a class="headerlink" href="#put-everything-relevant-into-one-synchronized-timeseries" title="Permalink to this headline"></a></h2>
<p>We will now create a single TimeSeries with every relevant signal. Note that for kinematics, we use <code class="docutils literal notranslate"><span class="pre">merge</span></code> instead of simply copying the data, because kinetics and kinematics have different sampling rate and therefore the data have different lengths. Merging takes care of resampling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_all</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add frames (to put pushrim kinetics in global coordinates,</span>
<span class="c1"># and at the end to express shoulder dynamics in local coordinates).</span>
<span class="n">ts_all</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;WheelR&#39;</span><span class="p">,</span> <span class="s1">&#39;HumerusR&#39;</span><span class="p">,</span> <span class="s1">&#39;Trunk&#39;</span><span class="p">]),</span>
    <span class="n">resample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Add the forces and moments, expressed in global coordinates.</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
    <span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WheelR&#39;</span><span class="p">]</span>
    <span class="p">)</span>

<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
    <span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WheelR&#39;</span><span class="p">]</span>
    <span class="p">)</span>

<span class="c1"># Add relevant markers</span>
<span class="n">ts_all</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">markers</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;RearWheelCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowR&#39;</span><span class="p">,</span> <span class="s1">&#39;Body_AcromionR&#39;</span><span class="p">]),</span>
    <span class="n">resample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Check the contents of this TimeSeries</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
              &#39;WheelR&#39;: &lt;array of shape (2421, 4, 4)&gt;
            &#39;HumerusR&#39;: &lt;array of shape (2421, 4, 4)&gt;
               &#39;Trunk&#39;: &lt;array of shape (2421, 4, 4)&gt;
           &#39;HubForces&#39;: &lt;array of shape (2421, 4)&gt;
          &#39;HubMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;RearWheelCenterR&#39;: &lt;array of shape (2421, 4)&gt;
      &#39;RadialStyloidR&#39;: &lt;array of shape (2421, 4)&gt;
              &#39;ElbowR&#39;: &lt;array of shape (2421, 4)&gt;
      &#39;Body_AcromionR&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-the-force-and-moments-at-the-wrist">
<h2>Calculate the force and moments at the wrist<a class="headerlink" href="#calculate-the-force-and-moments-at-the-wrist" title="Permalink to this headline"></a></h2>
<p>The same calculation is done on every segment, from distal to proximal. We begin with the segment ‘Wheel’ with the point of force application at the hub (since the measured values are referred at the hub).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty TimeSeries</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add the kinetics data to this TimeSeries</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubForces&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubMoments&#39;</span><span class="p">]</span>

<span class="c1"># Add the kinematics data to this TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForceApplicationPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RearWheelCenterR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RearWheelCenterR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>

<span class="c1"># Check the contents of the resulting TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div>
</div>
</div>
</div>
<p>We now have everything to start computing the forces and moments at the wrist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We neglect the inertial properties of the wheel. This is a limit and we could improve on this.</span>
<span class="n">inertial_constants</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Mass&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;COMProximalRatio&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;GyrationCOMRatio&#39;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="calculate-the-com-position-of-the-wheel-segment">
<h3>Calculate the COM position of the wheel segment<a class="headerlink" href="#calculate-the-com-position-of-the-wheel-segment" title="Permalink to this headline"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_position</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-the-com-acceleration-of-the-wheel-segment">
<h3>Calculate the COM acceleration of the wheel segment<a class="headerlink" href="#calculate-the-com-acceleration-of-the-wheel-segment" title="Permalink to this headline"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_acceleration</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-the-wheel-segment-s-angles-around-the-global-x-y-and-z-axes">
<h3>Calculate the wheel segment’s angles around the global x, y and z axes<a class="headerlink" href="#calculate-the-wheel-segment-s-angles-around-the-global-x-y-and-z-axes" title="Permalink to this headline"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_angles</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;SegmentAngles&#39;: &lt;array of shape (2421, 3)&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-the-segment-s-angular-velocity-and-acceleration-around-the-global-x-y-and-z-axes">
<h3>Calculate the segment’s angular velocity and acceleration around the global x, y and z axes<a class="headerlink" href="#calculate-the-segment-s-angular-velocity-and-acceleration-around-the-global-x-y-and-z-axes" title="Permalink to this headline"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_rotation_rates</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;SegmentAngles&#39;: &lt;array of shape (2421, 3)&gt;
             &#39;AngularVelocity&#39;: &lt;array of shape (2421, 3)&gt;
         &#39;AngularAcceleration&#39;: &lt;array of shape (2421, 3)&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="finally-calculate-the-proximal-forces-and-moments">
<h3>Finally, calculate the proximal forces and moments<a class="headerlink" href="#finally-calculate-the-proximal-forces-and-moments" title="Permalink to this headline"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_proximal_wrench</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;SegmentAngles&#39;: &lt;array of shape (2421, 3)&gt;
             &#39;AngularVelocity&#39;: &lt;array of shape (2421, 3)&gt;
         &#39;AngularAcceleration&#39;: &lt;array of shape (2421, 3)&gt;
            &#39;RadiusOfGyration&#39;: &lt;array of shape (2421, 3)&gt;
              &#39;ProximalForces&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;ProximalMoments&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-the-calculated-distal-forces-and-moments-to-the-ts-all-timeseries">
<h3>Add the calculated distal forces and moments to the ts_all TimeSeries<a class="headerlink" href="#add-the-calculated-distal-forces-and-moments-to-the-ts-all-timeseries" title="Permalink to this headline"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalForces&#39;</span><span class="p">]</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalMoments&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the hub and wrist forces (identical since</span>
<span class="c1"># there were no inertial constants on this segment)</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;HubForces&#39;</span><span class="p">,</span> <span class="s1">&#39;WristForces&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_24_0.png" src="../../../_images/index_24_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the hub and wrist moments (not identical</span>
<span class="c1"># because of the lever arm between the hub and wrist)</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;HubMoments&#39;</span><span class="p">,</span> <span class="s1">&#39;WristMoments&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_25_01.png" src="../../../_images/index_25_01.png" />
</div>
</div>
</div>
</div>
<div class="section" id="calculate-the-force-and-moments-at-the-elbow">
<h2>Calculate the force and moments at the elbow<a class="headerlink" href="#calculate-the-force-and-moments-at-the-elbow" title="Permalink to this headline"></a></h2>
<p>The method is identical for the other segments. However, for these segments, we will define inertial constants based on anthropometric tables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inertial_constants</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">get_anthropometrics</span><span class="p">(</span>
    <span class="n">segment_name</span><span class="o">=</span><span class="s1">&#39;Forearm&#39;</span><span class="p">,</span>
    <span class="n">total_mass</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="n">inertial_constants</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                     &#39;Mass&#39;: 1.28
         &#39;COMProximalRatio&#39;: 0.43
           &#39;COMDistalRatio&#39;: 0.57
         &#39;GyrationCOMRatio&#39;: 0.303
    &#39;GyrationProximalRatio&#39;: 0.526
      &#39;GyrationDistalRatio&#39;: 0.647
}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty TimeSeries</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add the kinetics data to this TimeSeries</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristForces&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristMoments&#39;</span><span class="p">]</span>

<span class="c1"># Add the kinematics data to this TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForceApplicationPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowR&#39;</span><span class="p">]</span>

<span class="c1"># Calculate the COM position and acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_position</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_acceleration</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the segment&#39;s angle, angular velocity and angular acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_angles</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_rotation_rates</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the proximal forces and moments</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_proximal_wrench</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="c1"># Add the calculated forces and moments to ts_all</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalForces&#39;</span><span class="p">]</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalMoments&#39;</span><span class="p">]</span>

<span class="c1"># Compare the wrist forces to the elbow forces</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;WristForces&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowForces&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_28_0.png" src="../../../_images/index_28_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare the wrist moments to the elbow moments</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;WristMoments&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowMoments&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_29_0.png" src="../../../_images/index_29_0.png" />
</div>
</div>
</div>
<div class="section" id="calculate-the-force-and-moments-at-the-shoulder">
<h2>Calculate the force and moments at the shoulder<a class="headerlink" href="#calculate-the-force-and-moments-at-the-shoulder" title="Permalink to this headline"></a></h2>
<p>We proceed exactly as for the elbow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inertial_constants</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">get_anthropometrics</span><span class="p">(</span>
    <span class="n">segment_name</span><span class="o">=</span><span class="s1">&#39;UpperArm&#39;</span><span class="p">,</span>
    <span class="n">total_mass</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="n">inertial_constants</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
                     &#39;Mass&#39;: 2.24
         &#39;COMProximalRatio&#39;: 0.436
           &#39;COMDistalRatio&#39;: 0.564
         &#39;GyrationCOMRatio&#39;: 0.322
    &#39;GyrationProximalRatio&#39;: 0.542
      &#39;GyrationDistalRatio&#39;: 0.645
}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty TimeSeries</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add the kinetics data to this TimeSeries</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowForces&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowMoments&#39;</span><span class="p">]</span>

<span class="c1"># Add the kinematics data to this TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForceApplicationPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Body_AcromionR&#39;</span><span class="p">]</span>

<span class="c1"># Calculate the COM position and acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_position</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_acceleration</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the segment&#39;s angle, angular velocity and angular acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_angles</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_rotation_rates</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the proximal forces and moments</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_proximal_wrench</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="c1"># Add the calculated forces and moments to ts_all</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalForces&#39;</span><span class="p">]</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalMoments&#39;</span><span class="p">]</span>

<span class="c1"># Compare the elbow forces to the shoulder forces</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;ElbowForces&#39;</span><span class="p">,</span> <span class="s1">&#39;ShoulderForces&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_32_0.png" src="../../../_images/index_32_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare the elbow moments to the shoulder moments</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;ElbowMoments&#39;</span><span class="p">,</span> <span class="s1">&#39;ShoulderMoments&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/index_33_0.png" src="../../../_images/index_33_0.png" />
</div>
</div>
</div>
<div class="section" id="get-the-forces-and-moments-in-the-local-coordinate-system">
<h2>Get the forces and moments in the local coordinate system<a class="headerlink" href="#get-the-forces-and-moments-in-the-local-coordinate-system" title="Permalink to this headline"></a></h2>
<p>Please note that every force and moment we just calculated is expressed in global coordinates, which is of limited value for interpretation. It is much more useful to express these data in local coordinates. Several conventions may be used, here we will express the shoulder forces in the trunk coordinate system, and the shoulder moments in the humeral coordinate system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new TimeSeries</span>
<span class="n">local_joint_dynamics</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ts_all</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">ts_all</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Fill it with the external forces</span>
<span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderForces&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Trunk&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># This is the forces applied by the trunk on the humerus. Normally we want the contrary,</span>
<span class="c1"># the external forces applied by the humerus on the trunk:</span>
<span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">]</span>

<span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderMoments&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HumerusR&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="local-forces">
<h3>Local forces<a class="headerlink" href="#local-forces" title="Permalink to this headline"></a></h3>
<p>Let’s plot the shoulder forces in the trunk reference frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Forces&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Anterior&#39;</span><span class="p">,</span> <span class="s1">&#39;Upward&#39;</span><span class="p">,</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;External forces in the trunk coordinate system:&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>External forces in the trunk coordinate system:
</pre></div>
</div>
<img alt="../../../_images/index_37_1.png" src="../../../_images/index_37_1.png" />
</div>
</div>
</div>
<div class="section" id="local-moments">
<h3>Local moments<a class="headerlink" href="#local-moments" title="Permalink to this headline"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Moments&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Abduction&#39;</span><span class="p">,</span> <span class="s1">&#39;Internal rotation&#39;</span><span class="p">,</span> <span class="s1">&#39;Flexion&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Net internal shoulder moments:&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Net internal shoulder moments:
</pre></div>
</div>
<img alt="../../../_images/index_39_1.png" src="../../../_images/index_39_1.png" />
</div>
</div>
<p>For more information on inversedynamics, please check the <a class="reference internal" href="../../../api/kineticstoolkit.inversedynamics.html"><span class="doc std std-doc">API Reference for the inversedynamics module</span></a>.</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>R. Dumas, R. Aissaoui, and J. A. De Guise, “A 3D generic inverse dynamic method using wrench notation and quaternion algebra,” Comput Meth Biomech Biomed Eng, vol. 7, no. 3, pp. 159–166, 2004.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../02_anthropometrics/index.html" class="btn btn-neutral float-left" title="Anthropometrics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Félix Chénier.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>