


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Inverse Dynamics &mdash; Kinetics Toolkit (dev) master documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Anthropometrics" href="anthropometrics.html" />


 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo_development.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">GETTING STARTED</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_kinetics_toolkit.html">What is Kinetics Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timeseries.html">TimeSeries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TUTORIALS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../loadsave.html">Saving and loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters/filters.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cycles.html">Detecting and normalizing cycles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geometry/geometry.html">Rigid body geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kinematics/kinematics.html">Kinematics analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pushrimkinetics.html">Wheelchair kinetics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IN DEPTH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lab_mode.html">Lab mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://felixchenier.uqam.ca/ktk_develop">Development website</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/felixchenier/kineticstoolkit">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FOR DEVELOPERS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing from git-hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">Developer manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials for unreleased features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="reconstruction.html">Reconstructing virtual markers</a></li>
<li class="toctree-l2"><a class="reference internal" href="anthropometrics.html">Anthropometrics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Inverse Dynamics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Loading-sample-data">Loading sample data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Put-everything-relevant-into-one,-synchronized-TimeSeries">Put everything relevant into one, synchronized TimeSeries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculate-the-force-and-moments-at-the-wrist">Calculate the force and moments at the wrist</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Calculate-the-COM-position-of-the-wheel-segment">Calculate the COM position of the wheel segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Calculate-the-COM-acceleration-of-the-wheel-segment">Calculate the COM acceleration of the wheel segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Calculate-the-wheel-segment’s-angles-around-the-global-x,-y-and-z-axes">Calculate the wheel segment’s angles around the global x, y and z axes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Calculate-the-segment’s-angular-velocity-and-acceleration-around-the-global-x,-y-and-z-axes">Calculate the segment’s angular velocity and acceleration around the global x, y and z axes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Finally,-calculate-the-proximal-forces-and-moments">Finally, calculate the proximal forces and moments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Add-the-calculated-distal-forces-and-moments-to-the-ts_all-TimeSeries">Add the calculated distal forces and moments to the ts_all TimeSeries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Calculate-the-force-and-moments-at-the-elbow">Calculate the force and moments at the elbow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculate-the-force-and-moments-at-the-shoulder">Calculate the force and moments at the shoulder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Get-the-forces-and-moments-in-the-local-coordinate-system">Get the forces and moments in the local coordinate system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Local-forces">Local forces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Local-moments">Local moments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kinetics Toolkit (dev)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials for unreleased features</a> &raquo;</li>
        
      <li>Inverse Dynamics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
      
        <a href="anthropometrics.html" class="btn btn-neutral float-left" title="Anthropometrics" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Inverse-Dynamics">
<h1>Inverse Dynamics<a class="headerlink" href="#Inverse-Dynamics" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="../api/kineticstoolkit.inversedynamics.html"><span class="doc">inversedynamics</span></a> module calculates the proximal forces and moments based on the segment’s kinematics and distal forces and moments, based on the general method published in [1].</p>
<p>The results are the forces and moments applied by the distal segment on the proximal articulation, in the global coordinates system.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an experimental module, its API and behaviour may change in the future.</p>
</div>
<p>This module will be redesigned to make use of the <code class="docutils literal notranslate"><span class="pre">anthropometrics</span></code> module currently in development.</p>
<p>[1] R. Dumas, R. Aissaoui, and J. A. De Guise, “A 3D generic inverse dynamic method using wrench notation and quaternion algebra,” Comput Meth Biomech Biomed Eng, vol. 7, no. 3, pp. 159–166, 2004.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">kineticstoolkit.lab</span> <span class="k">as</span> <span class="nn">ktk</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="section" id="Loading-sample-data">
<h2>Loading sample data<a class="headerlink" href="#Loading-sample-data" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, we will load propulsion data from a sprint in Wheelchair Basketball. Kinetics were recorded using an instrumented wheel (SmartWheel) and kinematics were recorded using an optoelectronic system (Optitrack). Both are synchronized.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load kinetics</span>
<span class="n">kinetics</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">ktk</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">root_folder</span> <span class="o">+</span>
    <span class="s1">&#39;/data/inversedynamics/basketball_kinetics.ktk.zip&#39;</span><span class="p">)</span>

<span class="c1"># Change some signs to match (locally): x anterior, # y up, z lateral (right)</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Keep everything between sync and stop recording events.</span>
<span class="n">kinetics</span> <span class="o">=</span> <span class="n">kinetics</span><span class="o">.</span><span class="n">get_ts_between_events</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>

<span class="c1"># Look at the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Forces&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">kinetics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Moments&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_3_0.png" src="../_images/dev_inversedynamics_3_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load kinematics</span>
<span class="n">kinematics</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">ktk</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">root_folder</span> <span class="o">+</span>
    <span class="s1">&#39;/data/inversedynamics/basketball_kinematics.ktk.zip&#39;</span><span class="p">)[</span><span class="s1">&#39;Kinematics&#39;</span><span class="p">]</span>

<span class="c1"># Extract markers</span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">kinematics</span><span class="p">[</span><span class="s1">&#39;Markers&#39;</span><span class="p">]</span>
<span class="n">markers</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">kinetics</span><span class="o">.</span><span class="n">events</span>

<span class="c1"># Extract frames</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">kinematics</span><span class="p">[</span><span class="s1">&#39;ReferenceFrames&#39;</span><span class="p">]</span>
<span class="n">frames</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">kinetics</span><span class="o">.</span><span class="n">events</span>

<span class="c1"># Keep everything between sync and stop recording events.</span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">get_ts_between_events</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span><span class="o">.</span><span class="n">get_ts_between_events</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>

<span class="c1"># Plot one sample</span>
<span class="n">markers</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">)</span>

<span class="c1"># Check what markers are available</span>
<span class="n">markers</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                        &#39;Body_C7&#39;: &lt;array of shape (1210, 4)&gt;
                 &#39;Body_AcromionR&#39;: &lt;array of shape (1210, 4)&gt;
        &#39;Body_LateralEpicondyleR&#39;: &lt;array of shape (1210, 4)&gt;
                     &#39;Body_HandR&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
                    &#39;SWR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
                   &#39;ArmR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;ForearmR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker1&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker2&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker3&#39;: &lt;array of shape (1210, 4)&gt;
            &#39;WheelchairR_Marker4&#39;: &lt;array of shape (1210, 4)&gt;
              &#39;RearWheelContactR&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;RearWheelCenterR&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;RearWheelTopR&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;BackwardRearAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;ForwardRearAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
    &#39;BackwardFrontAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;ForwardFrontAntitipCenterR&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;RearSeatR&#39;: &lt;array of shape (1210, 4)&gt;
                     &#39;FrontSeatR&#39;: &lt;array of shape (1210, 4)&gt;
                &#39;BackrestHeightR&#39;: &lt;array of shape (1210, 4)&gt;
             &#39;ExternalMalleolusR&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;FemoralLateralEpicondyleR&#39;: &lt;array of shape (1210, 4)&gt;
              &#39;RearWheelContactL&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;RearWheelCenterL&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;RearWheelTopL&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;BackwardRearAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;ForwardRearAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
    &#39;BackwardFrontAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
     &#39;ForwardFrontAntitipCenterL&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;RearSeatL&#39;: &lt;array of shape (1210, 4)&gt;
                     &#39;FrontSeatL&#39;: &lt;array of shape (1210, 4)&gt;
                &#39;BackrestHeightL&#39;: &lt;array of shape (1210, 4)&gt;
             &#39;ExternalMalleolusL&#39;: &lt;array of shape (1210, 4)&gt;
      &#39;FemoralLateralEpicondyleL&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta2R&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta5R&#39;: &lt;array of shape (1210, 4)&gt;
                 &#39;RadialStyloidR&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;UlnarStyloidR&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;OlecraneR&#39;: &lt;array of shape (1210, 4)&gt;
       &#39;HumeralMedialEpicondyleR&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta2L&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;Meta5L&#39;: &lt;array of shape (1210, 4)&gt;
                 &#39;RadialStyloidL&#39;: &lt;array of shape (1210, 4)&gt;
                  &#39;UlnarStyloidL&#39;: &lt;array of shape (1210, 4)&gt;
                      &#39;OlecraneL&#39;: &lt;array of shape (1210, 4)&gt;
       &#39;HumeralMedialEpicondyleL&#39;: &lt;array of shape (1210, 4)&gt;
                         &#39;ElbowR&#39;: &lt;array of shape (1210, 4)&gt;
               &#39;WheelchairCenter&#39;: &lt;array of shape (1210, 4)&gt;
    &#39;WheelchairAnteriorDirection&#39;: &lt;array of shape (1210, 4)&gt;
                           &#39;L5S1&#39;: &lt;array of shape (1210, 4)&gt;
}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_4_1.png" src="../_images/dev_inversedynamics_4_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check what frames are available</span>
<span class="n">frames</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
    &#39;Wheelchair&#39;: &lt;array of shape (1210, 4, 4)&gt;
         &#39;Trunk&#39;: &lt;array of shape (1210, 4, 4)&gt;
        &#39;WheelL&#39;: &lt;array of shape (1210, 4, 4)&gt;
        &#39;WheelR&#39;: &lt;array of shape (1210, 4, 4)&gt;
      &#39;HumerusR&#39;: &lt;array of shape (1210, 4, 4)&gt;
}
</pre></div></div>
</div>
</div>
<div class="section" id="Put-everything-relevant-into-one,-synchronized-TimeSeries">
<h2>Put everything relevant into one, synchronized TimeSeries<a class="headerlink" href="#Put-everything-relevant-into-one,-synchronized-TimeSeries" title="Permalink to this headline">¶</a></h2>
<p>We will now create a single TimeSeries with every relevant signal. Note that for kinematics, we use <code class="docutils literal notranslate"><span class="pre">merge</span></code> instead of simply copying the data, because kinetics and kinematics have different sampling rate and therefore the data have different lengths. Merging takes care of resampling.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts_all</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add frames (to put pushrim kinetics in global coordinates,</span>
<span class="c1"># and at the end to express shoulder dynamics in local coordinates).</span>
<span class="n">ts_all</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;WheelR&#39;</span><span class="p">,</span> <span class="s1">&#39;HumerusR&#39;</span><span class="p">,</span> <span class="s1">&#39;Trunk&#39;</span><span class="p">]),</span>
    <span class="n">resample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Add the forces and moments, expressed in global coordinates.</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
    <span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WheelR&#39;</span><span class="p">]</span>
    <span class="p">)</span>

<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_global_coordinates</span><span class="p">(</span>
    <span class="n">kinetics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WheelR&#39;</span><span class="p">]</span>
    <span class="p">)</span>

<span class="c1"># Add relevant markers</span>
<span class="n">ts_all</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">markers</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;RearWheelCenterR&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowR&#39;</span><span class="p">,</span> <span class="s1">&#39;Body_AcromionR&#39;</span><span class="p">]),</span>
    <span class="n">resample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Check the contents of this TimeSeries</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
              &#39;WheelR&#39;: &lt;array of shape (2421, 4, 4)&gt;
            &#39;HumerusR&#39;: &lt;array of shape (2421, 4, 4)&gt;
               &#39;Trunk&#39;: &lt;array of shape (2421, 4, 4)&gt;
           &#39;HubForces&#39;: &lt;array of shape (2421, 4)&gt;
          &#39;HubMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;RearWheelCenterR&#39;: &lt;array of shape (2421, 4)&gt;
      &#39;RadialStyloidR&#39;: &lt;array of shape (2421, 4)&gt;
              &#39;ElbowR&#39;: &lt;array of shape (2421, 4)&gt;
      &#39;Body_AcromionR&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div></div>
</div>
</div>
<div class="section" id="Calculate-the-force-and-moments-at-the-wrist">
<h2>Calculate the force and moments at the wrist<a class="headerlink" href="#Calculate-the-force-and-moments-at-the-wrist" title="Permalink to this headline">¶</a></h2>
<p>The same calculation is done on every segment, from distal to proximal. We begin with the segment ‘Wheel’ with the point of force application at the hub (since the measured values are referred at the hub).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create an empty TimeSeries</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add the kinetics data to this TimeSeries</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubForces&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HubMoments&#39;</span><span class="p">]</span>

<span class="c1"># Add the kinematics data to this TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForceApplicationPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RearWheelCenterR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RearWheelCenterR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>

<span class="c1"># Check the contents of the resulting TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div></div>
</div>
<p>We now have everything to start computing the forces and moments at the wrist.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We neglect the inertial properties of the wheel. This is a limit and we could improve on this.</span>
<span class="n">inertial_constants</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mass&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="s1">&#39;COMProximalRatio&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="s1">&#39;GyrationCOMRatio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="Calculate-the-COM-position-of-the-wheel-segment">
<h3>Calculate the COM position of the wheel segment<a class="headerlink" href="#Calculate-the-COM-position-of-the-wheel-segment" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_position</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div></div>
</div>
</div>
<div class="section" id="Calculate-the-COM-acceleration-of-the-wheel-segment">
<h3>Calculate the COM acceleration of the wheel segment<a class="headerlink" href="#Calculate-the-COM-acceleration-of-the-wheel-segment" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_acceleration</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div></div>
</div>
</div>
<div class="section" id="Calculate-the-wheel-segment’s-angles-around-the-global-x,-y-and-z-axes">
<h3>Calculate the wheel segment’s angles around the global x, y and z axes<a class="headerlink" href="#Calculate-the-wheel-segment’s-angles-around-the-global-x,-y-and-z-axes" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_angles</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;SegmentAngles&#39;: &lt;array of shape (2421, 3)&gt;
}
</pre></div></div>
</div>
</div>
<div class="section" id="Calculate-the-segment’s-angular-velocity-and-acceleration-around-the-global-x,-y-and-z-axes">
<h3>Calculate the segment’s angular velocity and acceleration around the global x, y and z axes<a class="headerlink" href="#Calculate-the-segment’s-angular-velocity-and-acceleration-around-the-global-x,-y-and-z-axes" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_rotation_rates</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;SegmentAngles&#39;: &lt;array of shape (2421, 3)&gt;
             &#39;AngularVelocity&#39;: &lt;array of shape (2421, 3)&gt;
         &#39;AngularAcceleration&#39;: &lt;array of shape (2421, 3)&gt;
}
</pre></div></div>
</div>
</div>
<div class="section" id="Finally,-calculate-the-proximal-forces-and-moments">
<h3>Finally, calculate the proximal forces and moments<a class="headerlink" href="#Finally,-calculate-the-proximal-forces-and-moments" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_proximal_wrench</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                &#39;DistalForces&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;DistalMoments&#39;: &lt;array of shape (2421, 4)&gt;
    &#39;ForceApplicationPosition&#39;: &lt;array of shape (2421, 4)&gt;
         &#39;DistalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
       &#39;ProximalJointPosition&#39;: &lt;array of shape (2421, 4)&gt;
                 &#39;COMPosition&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;COMAcceleration&#39;: &lt;array of shape (2421, 4)&gt;
               &#39;SegmentAngles&#39;: &lt;array of shape (2421, 3)&gt;
             &#39;AngularVelocity&#39;: &lt;array of shape (2421, 3)&gt;
         &#39;AngularAcceleration&#39;: &lt;array of shape (2421, 3)&gt;
            &#39;RadiusOfGyration&#39;: &lt;array of shape (2421, 3)&gt;
              &#39;ProximalForces&#39;: &lt;array of shape (2421, 4)&gt;
             &#39;ProximalMoments&#39;: &lt;array of shape (2421, 4)&gt;
}
</pre></div></div>
</div>
</div>
<div class="section" id="Add-the-calculated-distal-forces-and-moments-to-the-ts_all-TimeSeries">
<h3>Add the calculated distal forces and moments to the ts_all TimeSeries<a class="headerlink" href="#Add-the-calculated-distal-forces-and-moments-to-the-ts_all-TimeSeries" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalForces&#39;</span><span class="p">]</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalMoments&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the hub and wrist forces (identical since</span>
<span class="c1"># there were no inertial constants on this segment)</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;HubForces&#39;</span><span class="p">,</span> <span class="s1">&#39;WristForces&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_24_0.png" src="../_images/dev_inversedynamics_24_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the hub and wrist moments (not identical</span>
<span class="c1"># because of the lever arm between the hub and wrist)</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;HubMoments&#39;</span><span class="p">,</span> <span class="s1">&#39;WristMoments&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_25_0.png" src="../_images/dev_inversedynamics_25_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Calculate-the-force-and-moments-at-the-elbow">
<h2>Calculate the force and moments at the elbow<a class="headerlink" href="#Calculate-the-force-and-moments-at-the-elbow" title="Permalink to this headline">¶</a></h2>
<p>The method is identical for the other segments. However, for these segments, we will define inertial constants based on anthropometric tables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">inertial_constants</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">get_anthropometrics</span><span class="p">(</span>
    <span class="n">segment_name</span><span class="o">=</span><span class="s1">&#39;Forearm&#39;</span><span class="p">,</span>
    <span class="n">total_mass</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="n">inertial_constants</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                     &#39;Mass&#39;: 1.28
         &#39;COMProximalRatio&#39;: 0.43
           &#39;COMDistalRatio&#39;: 0.57
         &#39;GyrationCOMRatio&#39;: 0.303
    &#39;GyrationProximalRatio&#39;: 0.526
      &#39;GyrationDistalRatio&#39;: 0.647
}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create an empty TimeSeries</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add the kinetics data to this TimeSeries</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristForces&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WristMoments&#39;</span><span class="p">]</span>

<span class="c1"># Add the kinematics data to this TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForceApplicationPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RadialStyloidR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowR&#39;</span><span class="p">]</span>

<span class="c1"># Calculate the COM position and acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_position</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_acceleration</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the segment&#39;s angle, angular velocity and angular acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_angles</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_rotation_rates</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the proximal forces and moments</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_proximal_wrench</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="c1"># Add the calculated forces and moments to ts_all</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalForces&#39;</span><span class="p">]</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalMoments&#39;</span><span class="p">]</span>

<span class="c1"># Compare the wrist forces to the elbow forces</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;WristForces&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowForces&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_28_0.png" src="../_images/dev_inversedynamics_28_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compare the wrist moments to the elbow moments</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;WristMoments&#39;</span><span class="p">,</span> <span class="s1">&#39;ElbowMoments&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_29_0.png" src="../_images/dev_inversedynamics_29_0.png" />
</div>
</div>
</div>
<div class="section" id="Calculate-the-force-and-moments-at-the-shoulder">
<h2>Calculate the force and moments at the shoulder<a class="headerlink" href="#Calculate-the-force-and-moments-at-the-shoulder" title="Permalink to this headline">¶</a></h2>
<p>We proceed exactly as for the elbow.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">inertial_constants</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">get_anthropometrics</span><span class="p">(</span>
    <span class="n">segment_name</span><span class="o">=</span><span class="s1">&#39;UpperArm&#39;</span><span class="p">,</span>
    <span class="n">total_mass</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="n">inertial_constants</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
                     &#39;Mass&#39;: 2.24
         &#39;COMProximalRatio&#39;: 0.436
           &#39;COMDistalRatio&#39;: 0.564
         &#39;GyrationCOMRatio&#39;: 0.322
    &#39;GyrationProximalRatio&#39;: 0.542
      &#39;GyrationDistalRatio&#39;: 0.645
}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create an empty TimeSeries</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">kinetics</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Add the kinetics data to this TimeSeries</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowForces&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowMoments&#39;</span><span class="p">]</span>

<span class="c1"># Add the kinematics data to this TimeSeries.</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ForceApplicationPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DistalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ElbowR&#39;</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalJointPosition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Body_AcromionR&#39;</span><span class="p">]</span>

<span class="c1"># Calculate the COM position and acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_position</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_com_acceleration</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the segment&#39;s angle, angular velocity and angular acceleration</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_angles</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_segment_rotation_rates</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Calculate the proximal forces and moments</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">inversedynamics</span><span class="o">.</span><span class="n">calculate_proximal_wrench</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">inertial_constants</span><span class="p">)</span>

<span class="c1"># Add the calculated forces and moments to ts_all</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderForces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalForces&#39;</span><span class="p">]</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderMoments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ProximalMoments&#39;</span><span class="p">]</span>

<span class="c1"># Compare the elbow forces to the shoulder forces</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;ElbowForces&#39;</span><span class="p">,</span> <span class="s1">&#39;ShoulderForces&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_32_0.png" src="../_images/dev_inversedynamics_32_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compare the elbow moments to the shoulder moments</span>
<span class="n">ts_all</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="s1">&#39;ElbowMoments&#39;</span><span class="p">,</span> <span class="s1">&#39;ShoulderMoments&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_33_0.png" src="../_images/dev_inversedynamics_33_0.png" />
</div>
</div>
</div>
<div class="section" id="Get-the-forces-and-moments-in-the-local-coordinate-system">
<h2>Get the forces and moments in the local coordinate system<a class="headerlink" href="#Get-the-forces-and-moments-in-the-local-coordinate-system" title="Permalink to this headline">¶</a></h2>
<p>Please note that every force and moment we just calculated is expressed in global coordinates, which is of limited value for interpretation. It is much more useful to express these data in local coordinates. Several conventions may be used, here we will express the shoulder forces in the trunk coordinate system, and the shoulder moments in the humeral coordinate system.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create a new TimeSeries</span>
<span class="n">local_joint_dynamics</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ts_all</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">ts_all</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

<span class="c1"># Fill it with the external forces</span>
<span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderForces&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Trunk&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># This is the forces applied by the trunk on the humerus. Normally we want the contrary,</span>
<span class="c1"># the external forces applied by the humerus on the trunk:</span>
<span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Forces&#39;</span><span class="p">]</span>

<span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Moments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ktk</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">get_local_coordinates</span><span class="p">(</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ShoulderMoments&#39;</span><span class="p">],</span>
    <span class="n">ts_all</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;HumerusR&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Local-forces">
<h3>Local forces<a class="headerlink" href="#Local-forces" title="Permalink to this headline">¶</a></h3>
<p>Let’s plot the shoulder forces in the trunk reference frame:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Forces&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Anterior&#39;</span><span class="p">,</span> <span class="s1">&#39;Upward&#39;</span><span class="p">,</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;External forces in the trunk coordinate system:&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
External forces in the trunk coordinate system:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_37_1.png" src="../_images/dev_inversedynamics_37_1.png" />
</div>
</div>
</div>
<div class="section" id="Local-moments">
<h3>Local moments<a class="headerlink" href="#Local-moments" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">local_joint_dynamics</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Moments&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Abduction&#39;</span><span class="p">,</span> <span class="s1">&#39;Internal rotation&#39;</span><span class="p">,</span> <span class="s1">&#39;Flexion&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Net internal shoulder moments:&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Net internal shoulder moments:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/dev_inversedynamics_39_1.png" src="../_images/dev_inversedynamics_39_1.png" />
</div>
</div>
<p>For more information on inversedynamics, please check the <a class="reference internal" href="../api/kineticstoolkit.inversedynamics.html"><span class="doc">API Reference for the inversedynamics module</span></a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="anthropometrics.html" class="btn btn-neutral float-left" title="Anthropometrics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2021, Félix Chénier.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>